(this["webpackJsonpreact-image-annotate"]=this["webpackJsonpreact-image-annotate"]||[]).push([[0],{1080:function(e,t,n){},1081:function(e,t,n){"use strict";n.r(t);var a=n(0),o=n.n(a),i=n(16),r=n.n(i),s=n(1084),l=n(436),c=n(1168);const d=Object(s.a)({container:{fontFamily:'"Inter", sans-serif'}}),g=Object(l.a)({typography:{fontFamily:'"Inter", "Roboto", sans-serif'},overrides:{MuiButton:{root:{textTransform:"none"}}}});var m=({children:e})=>{const t=d();return o.a.createElement(c.a,{theme:g},o.a.createElement("div",{className:t.container},e))},u=n(9),h=n(210),p=n(78),b=n(1172),y=n(686),f=n(688),E=n(689),O=n(690),x=n(241),w=n.n(x);const v=Object(s.a)({editBar:{padding:10,borderBottom:"1px solid #ccc",backgroundColor:"#f8f8f8",display:"flex",alignItems:"center","& .button":{margin:5}},select:{width:240,fontSize:14},contentArea:{padding:10},specificationArea:{padding:10}}),j=()=>{try{return JSON.parse(window.localStorage.getItem("customInput")||"{}")}catch(e){return{}}},I={"Simple Bounding Box":()=>({taskDescription:"Annotate each image according to this _markdown_ specification.",regionTagList:["has-bun"],regionClsList:["hotdog","not-hotdog"],enabledTools:["select","create-box"],images:[{src:"https://images.unsplash.com/photo-1496905583330-eb54c7e5915a?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=634&q=80",name:"hot-dogs-1"},{src:"https://www.bianchi.com/wp-content/uploads/2019/07/YPB17I555K.jpg",name:"bianchi-oltre-xr4"}],allowComments:!0}),"Simple Segmentation":()=>({taskDescription:"Annotate each image according to this _markdown_ specification.",regionClsList:["car","truck"],enabledTools:["select","create-polygon"],images:[{src:"https://images.unsplash.com/photo-1561518776-e76a5e48f731?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=750&q=80",name:"car-image-1"}]}),Custom:()=>j()};var T=({onOpenAnnotator:e,lastOutput:t})=>{const n=v(),i=Object(a.useState)(),r=Object(u.a)(i,2),s=r[0],l=r[1],c=Object(a.useState)(window.localStorage.getItem("customInput")?"Custom":"Simple Bounding Box"),d=Object(u.a)(c,2),g=d[0],m=d[1],x=Object(a.useState)(!1),T=Object(u.a)(x,2),C=T[0],S=T[1],N=Object(a.useState)(JSON.stringify(I[g](),null,"  ")),M=Object(u.a)(N,2),k=M[0],_=M[1];return o.a.createElement("div",null,o.a.createElement("div",{className:n.editBar},o.a.createElement("h3",null,"React Image Annotate"),o.a.createElement("div",{style:{flexGrow:1}}),o.a.createElement("div",null,o.a.createElement("div",{style:{display:"inline-flex"}},o.a.createElement(p.default,{className:n.select,value:{label:g,value:g},options:Object.keys(I).map(e=>({label:e,value:e})),onChange:e=>{m(e.value),_(JSON.stringify("Custom"===e.value?j():I[e.value](),null,"  "))}})),o.a.createElement(h.a,{className:"button",disabled:!t,onClick:()=>S(!0)},"View Output"),o.a.createElement(h.a,{className:"button",variant:"outlined",disabled:Boolean(s),onClick:()=>{e("Custom"===g?j():I[g])}},"Open Annotator"))),o.a.createElement("div",{className:n.contentArea,style:s?{border:"2px solid #f00"}:{border:"2px solid #fff"}},o.a.createElement("div",null,o.a.createElement(w.a,{value:k,language:"javascript",onChange:e=>{try{window.localStorage.setItem("customInput",JSON.stringify(JSON.parse(e))),l(null)}catch(t){l(t.toString())}_(e)},width:"100%",height:"550px"}))),o.a.createElement("div",{className:n.specificationArea},o.a.createElement("h2",null,"React Image Annotate Format"),o.a.createElement(b.a,{language:"javascript"},'\n{\n  taskDescription?: string, // markdown\n  regionTagList?: Array<string>,\n  regionClsList?: Array<string>,\n  imageTagList?: Array<string>,\n  imageClsList?: Array<string>,\n  // all tools are enabled by default\n  enabledTools?: Array< "select" | "create-point" | "create-box" | "create-polygon" | "create-line">,\n  selectedImage?: string, // initial selected image\n  images: Array<{\n    src: string,\n    thumbnailSrc?: string, // use this if you are using high-res images\n    name: string,\n    regions?: Array<{\n      id: string | number,\n      cls?: string,\n      color?: string,\n      tags?: Array<string>,\n\n      // Point\n      type: "point",\n      x: number, // [0-1] % of image width\n      y: number, // [0-1] % of image height\n\n      // Bounding Box\n      type: "box",\n      x: number, // [0-1] % of image width\n      y: number, // [0-1] % of image height\n      w: number, // [0-1] % of image width\n      h: number, // [0-1] % of image height\n\n      // Polygon\n      type: "polygon",\n      open?: boolean, // should last and first points be connected, default: true\n      points: Array<[number, number]> // [0-1] % of image width/height\n    }>\n  }>,\n}\n')),o.a.createElement(y.a,{fullScreen:!0,open:C},o.a.createElement(f.a,null,"React Image Annotate Output"),o.a.createElement(E.a,{style:{minWidth:400}},o.a.createElement(w.a,{value:JSON.stringify(t,null,"  "),language:"javascript",width:"100%",height:"550px"})),o.a.createElement(O.a,null,o.a.createElement(h.a,{onClick:()=>S(!1)},"Close"))))},C=n(4),S=n(111),N=n(438),M=n(177);var k=({mousePosition:e,x:t,y:n})=>{const i=Object(a.useState)(),r=Object(u.a)(i,2),s=(r[0],r[1]);return e&&(t=e.current.x,n=e.current.y),Object(a.useEffect)(()=>{if(!e)return;const a=setInterval(()=>{t===e.current.x&&n===e.current.y||s([e.current.x,e.current.y])},10);return()=>clearInterval(a)}),o.a.createElement(a.Fragment,null,o.a.createElement("div",{style:{position:"absolute",height:"100%",width:1,zIndex:10,backgroundColor:"#f00",left:t,pointerEvents:"none",top:0}}),o.a.createElement("div",{style:{position:"absolute",width:"100%",zIndex:10,height:1,backgroundColor:"#f00",top:n,pointerEvents:"none",left:0}}))},_=n(1171),L=n(22);const A=Object(N.a)("div")({"& > div":{width:"100%",height:"100%"}});var D=e=>{let t=e.children,n=Object(S.a)(e,["children"]);const i=Object(a.useState)(!1),r=Object(u.a)(i,2),s=r[0],l=r[1],c=Object(L.a)(e=>{s||l(!0),n.onMouseMove&&n.onMouseMove(e)}),d=Object(L.a)(e=>{setTimeout(()=>{s&&l(!1)},100)});return o.a.createElement(A,Object.assign({},n,{onMouseMove:c,onMouseLeave:d}),o.a.createElement(_.a,{enabled:s,removeScrollBar:!1},t))},R=n(1174),P=n(1170);var B=(e=1/0,t=1/0)=>{const n="undefined"!==typeof window,o=Object(R.a)({width:n?window.innerWidth:e,height:n?window.innerHeight:t}),i=Object(u.a)(o,2),r=i[0],s=i[1];return Object(a.useEffect)(()=>{if(!n)return;const e=()=>{s({width:window.innerWidth,height:window.innerHeight})};return window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}},[]),Object(P.a)(()=>{n&&(window.innerWidth===r.width&&window.innerHeight===r.height||s({width:window.innerWidth,height:window.innerHeight}))},100),r};var W=({canvasEl:e,changeMat:t,changeDragging:n,zoomStart:o,zoomEnd:i,changeZoomStart:r,changeZoomEnd:s,layoutParams:l,zoomWithPrimary:c,dragWithPrimary:d,mat:g,onMouseMove:m,onMouseUp:u,onMouseDown:h,dragging:p})=>{const b=Object(a.useRef)({x:0,y:0}),y=Object(a.useRef)({x:0,y:0}),f=(e,n)=>{const a=[n.x,n.y],o=a[0],i=a[1];let r="object"===typeof e?e.to/g.a:1+.2*e;g.translate(o,i).scaleU(r),g.a>2&&g.scaleU(2/g.a),g.a<.05&&g.scaleU(.05/g.a),g.translate(-o,-i),t(g.clone())};return{mouseEvents:{onMouseMove:n=>{const a=e.current.getBoundingClientRect(),i=a.left,r=a.top;y.current.x=b.current.x,y.current.y=b.current.y,b.current.x=n.clientX-i,b.current.y=n.clientY-r;const d=g.applyToPoint(b.current.x,b.current.y);c&&o&&s(d);const u=l.current,h=u.iw,f=u.ih;m({x:d.x/h,y:d.y/f}),p&&(g.translate(y.current.x-b.current.x,y.current.y-b.current.y),t(g.clone())),n.preventDefault()},onMouseDown:(e,t={})=>{if(e.preventDefault(),1===e.button||2===e.button||0===e.button&&d)return n(!0);const a=g.applyToPoint(b.current.x,b.current.y);if(c&&0===e.button)return r(a),void s(a);if(0===e.button){t.type,t.type;const e=l.current,n=e.iw,o=e.ih;h({x:a.x/n,y:a.y/o})}},onMouseUp:e=>{e.preventDefault();const a=g.applyToPoint(b.current.x,b.current.y);if(o){const e=a;if(Math.abs(o.x-e.x)<10&&Math.abs(o.y-e.y)<10)g.a<1?f({to:1},b.current):f({to:.25},b.current);else{const n=l.current,a=n.iw,r=n.ih;if(o.x>e.x){var i=[e.x,o.x];o.x=i[0],e.x=i[1]}if(o.y>e.y){var c=[e.y,o.y];o.y=c[0],e.y=c[1]}let s=Math.min((e.x-o.x)/a,(e.y-o.y)/r);s<.05&&(s=.05),s>10&&(s=10);const d=M.Matrix.from(1,0,0,1,-10,-10).translate(o.x,o.y).scaleU(s);t(d.clone())}r(null),s(null)}if(1===e.button||2===e.button||0===e.button&&d)return n(!1);if(0===e.button){const e=l.current,t=e.iw,n=e.ih;u({x:a.x/t,y:a.y/n})}},onWheel:e=>{const t=e.deltaY>0?1:e.deltaY<0?-1:0;f(t,b.current)},onContextMenu:e=>{e.preventDefault()}},mousePosition:b}};var z=({layoutParams:e,mat:t})=>Object(L.a)(n=>{const a=e.current,o=a.iw,i=a.ih,r=(e=>{switch(e.type){case"polygon":{const t={x:Math.min(...e.points.map(([e,t])=>e)),y:Math.min(...e.points.map(([e,t])=>t)),w:0,h:0};return t.w=Math.max(...e.points.map(([e,t])=>e))-t.x,t.h=Math.max(...e.points.map(([e,t])=>t))-t.y,t}case"keypoints":{const t=Math.min(...Object.values(e.points).map(({x:e,y:t})=>e)),n=Math.min(...Object.values(e.points).map(({x:e,y:t})=>t));return{x:t,y:n,w:Math.max(...Object.values(e.points).map(({x:e,y:t})=>e))-t,h:Math.max(...Object.values(e.points).map(({x:e,y:t})=>t))-n}}case"expanding-line":{const t={x:Math.min(...e.points.map(({x:e,y:t})=>e)),y:Math.min(...e.points.map(({x:e,y:t})=>t)),w:0,h:0};return t.w=Math.max(...e.points.map(({x:e,y:t})=>e))-t.x,t.h=Math.max(...e.points.map(({x:e,y:t})=>t))-t.y,t}case"line":return{x:e.x1,y:e.y1,w:0,h:0};case"box":return{x:e.x,y:e.y,w:e.w,h:e.h};case"point":return{x:e.x,y:e.y,w:0,h:0};default:return{x:0,y:0,w:0,h:0}}throw new Error("unknown region")})(n),s="point"===n.type?15:2,l={x:r.x*o-s,y:r.y*i-s,w:r.w*o+2*s,h:r.h*i+2*s};return Object(C.a)(Object(C.a)({},t.clone().inverse().applyToPoint(l.x,l.y)),{},{w:l.w/t.a,h:l.h/t.d})});const G=Object(N.a)("svg")({pointerEvents:"none",position:"absolute",zIndex:1,left:0,top:0,width:"100%",height:"100%","& text":{fill:"#fff"},"& path":{vectorEffect:"non-scaling-stroke",strokeWidth:2,opacity:.5,stroke:"#FFF",fill:"none",strokeDasharray:5,animationDuration:"4s",animationTimingFunction:"linear",animationIterationCount:"infinite",animationPlayState:"running"}});var H=({projectRegionBox:e,regions:t,pointDistancePrecision:n,realSize:i})=>o.a.createElement(G,null,t.filter(e=>"point"===e.type).flatMap((r,s)=>t.filter((e,t)=>t>s).filter(e=>"point"===e.type).map(t=>{const s=e(r),l=e(t),c={x:(s.x+s.w/2+l.x+l.w/2)/2,y:(s.y+s.h/2+l.y+l.h/2)/2};let d;if(i){const e=i.w,a=i.h,o=i.unitName;d=Math.sqrt(Math.pow(r.x*e-t.x*e,2)+Math.pow(r.y*a-t.y*a,2)).toFixed(n)+o}else d=(100*Math.sqrt(Math.pow(r.x-t.x,2)+Math.pow(r.y-t.y,2))).toFixed(n)+"%";return o.a.createElement(a.Fragment,null,o.a.createElement("path",{d:"M".concat(s.x+s.w/2,",").concat(s.y+s.h/2," L").concat(l.x+l.w/2,",").concat(l.y+l.h/2)}),o.a.createElement("text",{x:c.x,y:c.y},d))}))),V=n(187),U=n(54),F={regionInfo:{fontSize:12,cursor:"default",transition:"opacity 200ms",opacity:.5,"&:hover":{opacity:.9,cursor:"pointer"},"&.highlighted":{opacity:.9,"&:hover":{opacity:1}},fontWeight:600,color:U.a[900],padding:8,"& .name":{display:"flex",flexDirection:"row",alignItems:"center","& .circle":{marginRight:4,boxShadow:"0px 0px 2px rgba(0,0,0,0.4)",width:10,height:10,borderRadius:5}},"& .tags":{"& .tag":{color:U.a[700],display:"inline-block",margin:1,fontSize:10,textDecoration:"underline"}}},commentBox:{fontWeight:400,fontSize:13}},Y=n(32),K=n.n(Y),X=n(243),Z=n(79),J=n.n(Z),q=n(239),$=n.n(q),Q=n(213),ee=n(393),te=n(6),ne=n.n(te);const ae=Object(s.a)(F);var oe=Object(a.memo)(({region:e,editing:t,allowedClasses:n,allowedTags:i,onDelete:r,onChange:s,onClose:l,onOpen:c,onRegionClassAdded:d,allowComments:g})=>{const m=ae(),u=Object(a.useRef)(null);return o.a.createElement(V.a,{onClick:()=>t?null:c(e),className:K()(m.regionInfo,{highlighted:e.highlighted})},t?o.a.createElement("div",{style:{width:200}},o.a.createElement("div",{style:{display:"flex",flexDirection:"row"}},o.a.createElement("div",{style:{display:"flex",backgroundColor:e.color||"#888",color:"#fff",padding:4,paddingLeft:8,paddingRight:8,borderRadius:4,fontWeight:"bold",textShadow:"0px 0px 5px rgba(0,0,0,0.4)"}},e.type),o.a.createElement("div",{style:{flexGrow:1}}),o.a.createElement(X.a,{onClick:()=>r(e),tabIndex:-1,style:{width:22,height:22},size:"small",variant:"outlined"},o.a.createElement(J.a,{style:{marginTop:-8,width:16,height:16}}))),(n||[]).length>0&&o.a.createElement("div",{style:{marginTop:6}},o.a.createElement(ee.a,{placeholder:"Classification",onChange:(t,n)=>("create-option"==n.action&&d(t.value),s(Object(C.a)(Object(C.a)({},e),{},{cls:t.value}))),value:e.cls?{label:e.cls,value:e.cls}:null,options:Object(te.asMutable)(n.map(e=>({value:e,label:e})))})),(i||[]).length>0&&o.a.createElement("div",{style:{marginTop:4}},o.a.createElement(p.default,{onChange:t=>s(Object(C.a)(Object(C.a)({},e),{},{tags:t.map(e=>e.value)})),placeholder:"Tags",value:(e.tags||[]).map(e=>({label:e,value:e})),isMulti:!0,options:Object(te.asMutable)(i.map(e=>({value:e,label:e})))})),g&&o.a.createElement(Q.a,{InputProps:{className:m.commentBox},fullWidth:!0,multiline:!0,rows:3,ref:u,onClick:e=>{const t=u.current.children[0].children[0];if(t)return t.focus()},value:e.comment||"",onChange:t=>s(Object(C.a)(Object(C.a)({},e),{},{comment:t.target.value}))}),l&&o.a.createElement("div",{style:{marginTop:4,display:"flex"}},o.a.createElement("div",{style:{flexGrow:1}}),o.a.createElement(h.a,{onClick:()=>l(e),size:"small",variant:"contained",color:"primary"},o.a.createElement($.a,null)))):o.a.createElement("div",null,e.cls&&o.a.createElement("div",{className:"name"},o.a.createElement("div",{className:"circle",style:{backgroundColor:e.color}}),e.cls),e.tags&&o.a.createElement("div",{className:"tags"},e.tags.map(e=>o.a.createElement("div",{key:e,className:"tag"},e)))))},(e,t)=>e.editing===t.editing&&e.region===t.region),ie=n(136),re=n.n(ie);var se=({regions:e,projectRegionBox:t,mouseEvents:n,regionClsList:a,regionTagList:i,onBeginRegionEdit:r,onChangeRegion:s,onCloseRegionEdit:l,onDeleteRegion:c,layoutParams:d,imageSrc:g,RegionEditLabel:m,onRegionClassAdded:u,allowComments:h})=>{const p=null!=m?m:oe;return e.filter(e=>e.visible||void 0===e.visible).map(m=>{const b=t(m),y=d.current;y.iw,y.ih;let f=8;m.highlighted&&"box"===m.type&&(f+=6);const E=m.editingLabels&&!m.locked?170:m.tags?60:50,O=b.y>E,x=O?{left:b.x,top:b.y-f/2}:{left:b.x,top:b.y+b.h+f/2};return m.locked?o.a.createElement("div",{key:m.id,style:Object(C.a)(Object(C.a)({position:"absolute"},x),{},{zIndex:10+(m.editingLabels?5:0)})},o.a.createElement(V.a,{style:Object(C.a)(Object(C.a)({position:"absolute",left:0},O?{bottom:0}:{top:0}),{},{zIndex:10,backgroundColor:"#fff",borderRadius:4,padding:2,paddingBottom:0,opacity:.5,pointerEvents:"none"})},o.a.createElement(re.a,{style:{width:16,height:16,color:"#333"}}))):o.a.createElement("div",{key:m.id,style:Object(C.a)(Object(C.a)({position:"absolute"},x),{},{zIndex:10+(m.editingLabels?5:0),width:200}),onMouseDown:e=>e.preventDefault(),onMouseUp:e=>e.preventDefault(),onMouseEnter:e=>{m.editingLabels&&(n.onMouseUp(e),e.button=1,n.onMouseUp(e))}},o.a.createElement("div",Object.assign({style:Object(C.a)({position:"absolute",zIndex:20,left:0},O?{bottom:0}:{top:0})},m.editingLabels?{}:((e,...t)=>{const n=Object(C.a)({},e);for(var a=0,o=t;a<o.length;a++){delete n[o[a]]}return n})(n,"onMouseDown","onMouseUp")),o.a.createElement(p,{allowedClasses:a,allowedTags:i,onOpen:r,onChange:s,onClose:l,onDelete:c,editing:m.editingLabels,region:m,regions:e,imageSrc:g,onRegionClassAdded:u,allowComments:h})))})},le=n(102),ce=n(104),de=n(105),ge=n(103),me=n(341),ue=n(342),he=n(101),pe=n(343),be=n(100),ye=n(344),fe=n(345),Ee=n(346);const Oe=[le.a[500],ce.a[500],de.a[500],ge.a[800],me.a[500],ue.a[700],he.a[500],pe.a[500],be.a[500],ye.a[500],fe.a[500],Ee.a[500]];Oe.map(e=>(2281701376|function(e){const t=(e=e.replace("#","")).substr(4,2)+e.substr(2,2)+e.substr(0,2);return parseInt(t,16)}(e))>>>0);var xe=Oe,we=n(1176);var ve=e=>{let t=Array.from(document.getElementsByTagName("img")).find(t=>t.src===e);const n=document.createElement("canvas"),a=n.getContext("2d");return t||(t=new Image,t.crossOrigin="anonymous",t.src=e),new Promise((e,o)=>{t.onload=()=>{n.width=t.naturalWidth,n.height=t.naturalHeight,a.drawImage(t,0,0);const o=a.getImageData(0,0,t.naturalWidth,t.naturalHeight);e(o)}})},je=n(188),Ie=n.n(je);var Te=({regions:e,regionClsList:t,imageSrc:n,imagePosition:i,zIndex:r=1,hide:s=!1,autoSegmentationOptions:l={type:"simple"}})=>{const c=Object(a.useState)(null),d=Object(u.a)(c,2),g=d[0],m=d[1],h=Object(a.useState)(),p=Object(u.a)(h,2),b=p[0],y=p[1];Object(a.useEffect)(()=>{n&&ve(n).then(e=>{Ie.a.setConfig(Object(C.a)({classNames:t},l)),Ie.a.loadImage(e),y(e)})},[n]),Object(we.a)(()=>{if(s)return;if(!g)return;if(!b)return;if(e.filter(e=>e.cls).length<2)return;const t=function(e){return e.map(e=>{switch(e.type){case"point":return{regionType:"point",classification:e.cls,x:e.x,y:e.y};case"polygon":return{regionType:"polygon",classification:e.cls,points:e.points.map(([e,t])=>({x:e,y:t}))};case"box":return{regionType:"bounding-box",classification:e.cls,centerX:e.x+e.w/2,centerY:e.y+e.h/2,width:e.w,height:e.h};default:return null}}).filter(Boolean)}(e);Ie.a.getMask(t).then(e=>{const t=g.getContext("2d");t.clearRect(0,0,e.width,e.height),t.putImageData(e,0,0)})},1e3,[g,b,e,s]);const f=Object(a.useMemo)(()=>{let e=i.bottomRight.x-i.topLeft.x,t=i.bottomRight.y-i.topLeft.y;return{display:s?"none":void 0,imageRendering:"pixelated",transform:"translateZ(0px)",left:i.topLeft.x,top:i.topLeft.y,width:isNaN(e)?0:e,height:isNaN(t)?0:t,zIndex:r,position:"absolute",pointerEvents:"none"}},[i.topLeft.x,i.topLeft.y,i.bottomRight.x,i.bottomRight.y,r,s]);return o.a.createElement("canvas",{style:f,width:b?b.width:0,height:b?b.height:0,ref:m})};const Ce=Object(s.a)({"@keyframes borderDance":{from:{strokeDashoffset:0},to:{strokeDashoffset:100}},highlightBox:{zIndex:2,transition:"opacity 500ms","&.highlighted":{zIndex:3},"&:not(.highlighted)":{opacity:0},"&:not(.highlighted):hover":{opacity:.6},"& path":{vectorEffect:"non-scaling-stroke",strokeWidth:2,stroke:"#FFF",fill:"none",strokeDasharray:5,animationName:"$borderDance",animationDuration:"4s",animationTimingFunction:"linear",animationIterationCount:"infinite",animationPlayState:"running"}}});var Se=({mouseEvents:e,dragWithPrimary:t,zoomWithPrimary:n,createWithPrimary:a,onBeginMovePoint:i,onSelectRegion:r,region:s,pbox:l})=>{const c=Ce();if(!l.w||l.w===1/0)return null;if(!l.h||l.h===1/0)return null;if(s.unfinished)return null;const d="point"===s.type?{left:l.x+l.w/2-30,top:l.y+l.h/2-30,width:60,height:60}:{left:l.x-5,top:l.y-5,width:l.w+10,height:l.h+10},g="point"===s.type?"M5,5 L".concat(d.width-5," 5L").concat(d.width-5," ").concat(d.height-5,"L5 ").concat(d.height-5,"Z"):"M5,5 L".concat(l.w+5,",5 L").concat(l.w+5,",").concat(l.h+5," L5,").concat(l.h+5," Z");return o.a.createElement("svg",Object.assign({key:s.id,className:K()(c.highlightBox,{highlighted:s.highlighted})},e,n||t?{}:{onMouseDown:t=>!s.locked&&"point"===s.type&&s.highlighted&&0===t.button?i(s):0!==t.button||a?void e.onMouseDown(t):r(s)},{style:Object(C.a)(Object(C.a)({},s.highlighted?{pointerEvents:"point"!==s.type?"none":void 0,cursor:"grab"}:{cursor:n||t||a?void 0:"pointer",pointerEvents:n||t||a&&!s.highlighted?"none":void 0}),{},{position:"absolute"},d)}),o.a.createElement("path",{d:g}))},Ne=n(692);const Me=Object(N.a)("div")({width:8,height:8,zIndex:2,border:"2px solid #FFF",position:"absolute"}),ke=[["nw-resize","n-resize","ne-resize"],["w-resize","grab","e-resize"],["sw-resize","s-resize","se-resize"]],_e=Object(a.memo)(({region:e,mouseEvents:t,projectRegionBox:n,dragWithPrimary:i,createWithPrimary:r,zoomWithPrimary:s,onBeginMovePoint:l,onSelectRegion:c,layoutParams:d,fullImageSegmentationMode:g=!1,mat:m,onBeginBoxTransform:u,onBeginMovePolygonPoint:h,onBeginMoveKeypoint:p,onAddPolygonPoint:b,showHighlightBox:y})=>{const f=n(e),E=d.current,O=E.iw,x=E.ih;return o.a.createElement(a.Fragment,null,o.a.createElement(D,null,y&&"polygon"!==e.type&&o.a.createElement(Se,{region:e,mouseEvents:t,dragWithPrimary:i,createWithPrimary:r,zoomWithPrimary:s,onBeginMovePoint:l,onSelectRegion:c,pbox:f}),"box"===e.type&&!i&&!s&&!e.locked&&e.highlighted&&m.a<1.2&&[[0,0],[.5,0],[1,0],[1,.5],[1,1],[.5,1],[0,1],[0,.5],[.5,.5]].map(([n,a],i)=>o.a.createElement(Me,Object.assign({key:i},t,{onMouseDown:o=>{if(0===o.button)return u(e,[2*n-1,2*a-1]);t.onMouseDown(o)},style:{left:f.x-4-2+f.w*n,top:f.y-4-2+f.h*a,cursor:ke[2*a][2*n],borderRadius:.5===n&&.5===a?4:void 0}}))),"polygon"===e.type&&!i&&!s&&!e.locked&&e.highlighted&&e.points.map(([n,a],i)=>{const r=m.clone().inverse().applyToPoint(n*O,a*x);return o.a.createElement(Me,Object.assign({key:i},t,{onMouseDown:n=>{if(0===n.button&&(!e.open||0===i))return h(e,i);t.onMouseDown(n)},style:{cursor:e.open?0===i?"pointer":void 0:"move",zIndex:10,pointerEvents:e.open&&i===e.points.length-1?"none":void 0,left:r.x-4,top:r.y-4}}))}),"polygon"===e.type&&e.highlighted&&!i&&!s&&!e.locked&&!e.open&&e.points.length>1&&e.points.map((t,n)=>[t,e.points[(n+1)%e.points.length]]).map(([e,t])=>[(e[0]+t[0])/2,(e[1]+t[1])/2]).map((n,a)=>{const i=m.clone().inverse().applyToPoint(n[0]*O,n[1]*x);return o.a.createElement(Me,Object.assign({key:a},t,{onMouseDown:o=>{if(0===o.button)return b(e,n,a+1);t.onMouseDown(o)},style:{cursor:"copy",zIndex:10,left:i.x-4,top:i.y-4,border:"2px dotted #fff",opacity:.5}}))}),"keypoints"===e.type&&!i&&!s&&!e.locked&&e.highlighted&&Object.entries(e.points).map(([n,{x:a,y:i}],r)=>{const s=m.clone().inverse().applyToPoint(a*O,i*x);return o.a.createElement(Ne.a,{title:n,key:r},o.a.createElement(Me,Object.assign({key:r},t,{onMouseDown:a=>{if(0===a.button&&(!e.open||0===r))return p(e,n);t.onMouseDown(a)},style:{cursor:e.open?0===r?"pointer":void 0:"move",zIndex:10,pointerEvents:e.open&&r===e.points.length-1?"none":void 0,left:s.x-4,top:s.y-4}})))})))},(e,t)=>e.region===t.region&&e.dragWithPrimary===t.dragWithPrimary&&e.createWithPrimary===t.createWithPrimary&&e.zoomWithPrimary===t.zoomWithPrimary&&e.mat===t.mat);var Le=Object(a.memo)(e=>e.regions.filter(e=>e.visible||void 0===e.visible).filter(e=>!e.locked).map((t,n)=>o.a.createElement(_e,Object.assign({key:t.id},e,{region:t}))),(e,t)=>e.regions===t.regions&&e.mat===t.mat);const Ae=Object(a.createContext)({showCrosshairs:!1,showHighlightBox:!0,wasdMode:!0}),De=()=>Object(a.useContext)(Ae);var Re=({children:e})=>{const t=Object(a.useState)(()=>(()=>{if(!window||!window.localStorage)return{};let e={};for(let n=0;n<window.localStorage.length;n++){const a=window.localStorage.key(n);if(a.startsWith("settings_"))try{e[a.replace("settings_","")]=JSON.parse(window.localStorage.getItem(a))}catch(t){}}return e})()),n=Object(u.a)(t,2),i=n[0],r=n[1];return o.a.createElement(Ae.Provider,{value:Object(C.a)(Object(C.a)({},i),{},{changeSetting:(e,t)=>{r(Object(C.a)(Object(C.a)({},i),{},{[e]:t})),window.localStorage.setItem("settings_".concat(e),JSON.stringify(t))}})},e)};const Pe=Object(N.a)("video")({zIndex:0,position:"absolute"}),Be=Object(N.a)("img")({zIndex:0,position:"absolute"}),We=Object(N.a)("div")({zIndex:0,position:"absolute",left:0,right:0,bottom:0,top:0,backgroundColor:"rgba(255,0,0,0.2)",color:"#ff0000",fontWeight:"bold",whiteSpace:"pre-wrap",padding:50});var ze=({imagePosition:e,mouseEvents:t,videoTime:n,videoSrc:i,imageSrc:r,onLoad:s,useCrossOrigin:l=!1,videoPlaying:c,onChangeVideoTime:d,onChangeVideoPlaying:g})=>{const m=De(),h=Object(a.useRef)(),p=Object(a.useRef)(),b=Object(a.useState)(),y=Object(u.a)(b,2),f=y[0],E=y[1];Object(a.useEffect)(()=>{!c&&h.current&&(h.current.currentTime=(n||0)/1e3)},[n]),Object(a.useEffect)(()=>{let e=!1;return h.current&&(c?(h.current.play(),e=!0,m.videoPlaybackSpeed&&(h.current.playbackRate=parseFloat(m.videoPlaybackSpeed))):h.current.pause()),function t(){if(!e)return;if(!h.current)return;const a=Math.floor(1e3*h.current.currentTime);n!==a&&d(a),h.current.paused&&(e=!1,g(!1)),requestAnimationFrame(t)}(),()=>{e=!1}},[c]);const O=Object(L.a)(e=>{const t=e.currentTarget;t.currentTime=(n||0)/1e3,s&&s({naturalWidth:t.videoWidth,naturalHeight:t.videoHeight,videoElm:t,duration:t.duration})}),x=Object(L.a)(e=>{const t=e.currentTarget;s&&s({naturalWidth:t.naturalWidth,naturalHeight:t.naturalHeight,imageElm:t})}),w=Object(L.a)(e=>{E("Could not load image\n\nMake sure your image works by visiting ".concat(r||i," in a web browser. If that URL works, the server hosting the URL may be not allowing you to access the image from your current domain. Adjust server settings to enable the image to be viewed.").concat(l?"\n\nYour image may be blocked because it's not being sent with CORs headers. To do pixel segmentation, browser web security requires CORs headers in order for the algorithm to read the pixel data from the image. CORs headers are easy to add if you're using an S3 bucket or own the server hosting your images.":"","\n\n If you need a hand, reach out to the community at universaldatatool.slack.com"))}),v=Object(a.useMemo)(()=>{let t=e.bottomRight.x-e.topLeft.x,n=e.bottomRight.y-e.topLeft.y;return{imageRendering:"pixelated",left:e.topLeft.x,top:e.topLeft.y,width:isNaN(t)?0:t,height:isNaN(n)?0:n}},[e.topLeft.x,e.topLeft.y,e.bottomRight.x,e.bottomRight.y]);return i||r?f?o.a.createElement(We,null,f):r&&void 0===n?o.a.createElement(Be,Object.assign({},t,{src:r,ref:p,style:v,onLoad:x,onError:w,crossOrigin:l?"anonymous":void 0})):o.a.createElement(Pe,Object.assign({},t,{ref:h,style:v,onLoadedMetadata:O,src:i||r})):o.a.createElement(We,null,"No imageSrc or videoSrc provided")},Ge=n(50),He=n.n(Ge);function Ve(e,t,n){return e<=t?t:e>=n?n:e}const Ue={point:Object(a.memo)(({region:e,iw:t,ih:n})=>o.a.createElement("g",{transform:"translate(".concat(e.x*t," ").concat(e.y*n,")")},o.a.createElement("path",{d:"M0 8L8 0L0 -8L-8 0Z",strokeWidth:2,stroke:e.color,fill:"transparent"}))),line:Object(a.memo)(({region:e,iw:t,ih:n})=>o.a.createElement("g",{transform:"translate(".concat(e.x1*t," ").concat(e.y1*n,")")},o.a.createElement("line",{strokeWidth:2,x1:0,y1:0,x2:(e.x2-e.x1)*t,y2:(e.y2-e.y1)*n,stroke:He()(e.color,.75),fill:He()(e.color,.25)}))),box:Object(a.memo)(({region:e,iw:t,ih:n})=>o.a.createElement("g",{transform:"translate(".concat(e.x*t," ").concat(e.y*n,")")},o.a.createElement("rect",{strokeWidth:2,x:0,y:0,width:Math.max(e.w*t,0),height:Math.max(e.h*n,0),stroke:He()(e.color,.75),fill:He()(e.color,.25)}))),polygon:Object(a.memo)(({region:e,iw:t,ih:n,fullSegmentationMode:a})=>{const i=e.open?"polyline":"polygon";return o.a.createElement(i,{points:e.points.map(([e,a])=>[e*t,a*n]).map(e=>e.join(" ")).join(" "),strokeWidth:2,stroke:He()(e.color,.75),fill:He()(e.color,.25)})}),keypoints:({region:e,iw:t,ih:n,keypointDefinitions:a})=>{const i=e.points,r=e.keypointsDefinitionId;if(!a[r])throw new Error('No definition for keypoint configuration "'.concat(r,'"'));const s=a[r],l=s.landmarks,c=s.connections;return o.a.createElement("g",null,Object.entries(i).map(([e,{x:a,y:i}],r)=>o.a.createElement("g",{key:r,transform:"translate(".concat(a*t," ").concat(i*n,")")},o.a.createElement("path",{d:"M0 8L8 0L0 -8L-8 0Z",strokeWidth:2,stroke:l[e].color,fill:"transparent"}))),c.map(([e,a])=>{const r=i[e],s=i[a],c=(r.x+s.x)/2,d=(r.y+s.y)/2;return o.a.createElement("g",{key:"".concat(r.x,",").concat(r.y,".").concat(s.x,",").concat(s.y)},o.a.createElement("line",{x1:r.x*t,y1:r.y*n,x2:c*t,y2:d*n,strokeWidth:2,stroke:l[e].color}),o.a.createElement("line",{x1:s.x*t,y1:s.y*n,x2:c*t,y2:d*n,strokeWidth:2,stroke:l[a].color}))}))},"expanding-line":Object(a.memo)(({region:e,iw:t,ih:n})=>{let a=e.expandingWidth,i=void 0===a?.005:a,r=e.points;i=r.slice(-1)[0].width||i;const s=r.map(({x:e,y:t,angle:n,width:a},o)=>{if(!n){const e=r[Ve(o+1,0,r.length-1)],t=r[Ve(o-1,0,r.length-1)];n=Math.atan2(t.x-e.x,t.y-e.y)+Math.PI/2}const s=Math.sin(n)*(a||i)/2,l=Math.cos(n)*(a||i)/2;return[{x:e+s,y:t+l},{x:e-s,y:t-l}]}),l=s.map(([e,t])=>e),c=s.map(([e,t])=>t).asMutable();c.reverse();const d=r.slice(-1)[0];return o.a.createElement(o.a.Fragment,null,o.a.createElement("polygon",{points:l.concat(e.candidatePoint?[e.candidatePoint]:[]).concat(c).map(e=>"".concat(e.x*t," ").concat(e.y*n)).join(" "),strokeWidth:2,stroke:He()(e.color,.75),fill:He()(e.color,.25)}),r.map(({x:a,y:i,angle:r},s)=>o.a.createElement("g",{key:s,transform:"translate(".concat(a*t," ").concat(i*n,") rotate(").concat(180*-(r||0)/Math.PI,")")},o.a.createElement("g",null,o.a.createElement("rect",{x:-5,y:-5,width:10,height:10,strokeWidth:2,stroke:He()(e.color,.75),fill:He()(e.color,.25)})))),o.a.createElement("rect",{x:d.x*t-8,y:d.y*n-8,width:16,height:16,strokeWidth:4,stroke:He()(e.color,.5),fill:"transparent"}))}),pixel:()=>null},Fe=Object(a.memo)(({regions:e,keypointDefinitions:t,iw:n,ih:a,fullSegmentationMode:i})=>e.filter(e=>!1!==e.visible).map(e=>{const r=Ue[e.type];return o.a.createElement(r,{key:e.regionId,region:e,iw:n,ih:a,keypointDefinitions:t,fullSegmentationMode:i})}),(e,t)=>e.regions===t.regions&&e.iw===t.iw&&e.ih===t.ih);var Ye=({mat:e,imagePosition:t,regions:n=[],keypointDefinitions:a,fullSegmentationMode:i})=>{const r=t.bottomRight.x-t.topLeft.x,s=t.bottomRight.y-t.topLeft.y;return isNaN(r)||isNaN(s)?null:o.a.createElement("svg",{width:r,height:s,style:{position:"absolute",zIndex:2,left:t.topLeft.x,top:t.topLeft.y,pointerEvents:"none",width:r,height:s}},o.a.createElement(Fe,{key:"wrapped-region-list",regions:n,iw:r,ih:s,keypointDefinitions:a,fullSegmentationMode:i}))};const Ke=Object(s.a)({canvas:{width:"100%",height:"100%",position:"relative",zIndex:1},zoomIndicator:{position:"absolute",bottom:16,right:0,backgroundColor:"rgba(0,0,0,0.4)",color:"#fff",opacity:.5,fontWeight:"bolder",fontSize:14,padding:4},fixedRegionLabel:{position:"absolute",zIndex:10,top:10,left:10,opacity:.5,transition:"opacity 500ms","&:hover":{opacity:1}}}),Xe=(e=null,{iw:t,ih:n}={})=>{let a=M.Matrix.from(1,0,0,1,-10,-10);return e&&t&&(a=a.translate(e.x*t,e.y*n).scaleU(e.w+.05)),a};var Ze=({regions:e,imageSrc:t,videoSrc:n,videoTime:i,realSize:r,showTags:s,onMouseMove:l=(e=>null),onMouseDown:c=(e=>null),onMouseUp:d=(e=>null),dragWithPrimary:g=!1,zoomWithPrimary:m=!1,createWithPrimary:h=!1,pointDistancePrecision:p=0,regionClsList:b,regionTagList:y,showCrosshairs:f,showHighlightBox:E=!0,showPointDistances:O,allowedArea:x,RegionEditLabel:w=null,videoPlaying:v=!1,showMask:j=!0,fullImageSegmentationMode:I,autoSegmentationOptions:T,onImageOrVideoLoaded:S,onChangeRegion:N,onBeginRegionEdit:M,onCloseRegionEdit:_,onBeginBoxTransform:A,onBeginMovePolygonPoint:P,onAddPolygonPoint:G,onBeginMoveKeypoint:V,onSelectRegion:U,onBeginMovePoint:F,onDeleteRegion:Y,onChangeVideoTime:K,onChangeVideoPlaying:X,onRegionClassAdded:Z,zoomOnAllowedArea:J=!0,modifyingAllowedArea:q=!1,keypointDefinitions:$,allowComments:Q})=>{const ee=Ke(),te=Object(a.useRef)(null),ne=Object(a.useRef)({}),ae=Object(R.a)(!1),ie=Object(u.a)(ae,2),re=ie[0],le=ie[1],ce=Object(R.a)(0),de=Object(u.a)(ce,2),ge=(de[0],de[1],Object(R.a)(null)),me=Object(u.a)(ge,2),ue=me[0],he=me[1],pe=Object(R.a)(null),be=Object(u.a)(pe,2),ye=be[0],fe=be[1],Ee=Object(R.a)(Xe()),Oe=Object(u.a)(Ee,2),xe=Oe[0],we=Oe[1],ve=(Object(a.useRef)({}),B());(({getLatestMat:e,changeMat:t})=>{const n=De().wasdMode;Object(a.useEffect)(()=>{if(!n)return;const a={w:[0,-10],a:[-10,0],s:[0,10],d:[10,0]},o={},i=Object.keys(a),r=e=>{i.includes(e.key)&&(o[e.key]=!0,e.preventDefault(),e.stopPropagation())},s=e=>{i.includes(e.key)&&(o[e.key]=!1,e.preventDefault(),e.stopPropagation())},l=setInterval(()=>{let n=e().clone(),i=!1;for(const e in o)o[e]&&(n=n.translate(...a[e]),i=!0);i&&t(n)},16);return window.addEventListener("keydown",r),window.addEventListener("keyup",s),()=>{clearInterval(l),window.removeEventListener("keydown",r),window.removeEventListener("keyup",s)}},[n])})({getLatestMat:Object(L.a)(()=>xe),changeMat:we});const je=W({canvasEl:te,dragging:re,mat:xe,layoutParams:ne,changeMat:we,zoomStart:ue,zoomEnd:ye,changeZoomStart:he,changeZoomEnd:fe,changeDragging:le,zoomWithPrimary:m,dragWithPrimary:g,onMouseMove:l,onMouseDown:c,onMouseUp:d}),Ie=je.mouseEvents,Ce=je.mousePosition;Object(a.useLayoutEffect)(()=>we(xe.clone()),[ve]);xe.applyToPoint(Ce.current.x,Ce.current.y);const Se=z({layoutParams:ne,mat:xe}),Ne=Object(a.useState)(),Me=Object(u.a)(Ne,2),ke=Me[0],_e=Me[1],Ae=Boolean(ke&&ke.naturalWidth),Re=Object(L.a)(({naturalWidth:e,naturalHeight:t,duration:n})=>{const a={naturalWidth:e,naturalHeight:t,duration:n};S&&S(a),_e(a),setTimeout(()=>_e(a),10)}),Pe=(()=>{const e=Object(a.useRef)(null);if(null===e.current){e.current={image:new Image,pattern:null};const t=document.createElement("canvas");t.width=100,t.height=100;const n=t.getContext("2d");e.current.image.onload=()=>{e.current.pattern=n.createPattern(e.current.image,"repeat")},e.current.image.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAC4jAAAuIwF4pT92AAAAB3RJTUUH4wMSAxY5oG+lzgAAABl0RVh0Q29tbWVudABDcmVhdGVkIHdpdGggR0lNUFeBDhcAAAAcSURBVAjXY/jPwPCfAQnA+TAGugLcAhhakRUAAK3lEe8m9qZhAAAAAElFTkSuQmCC"}return e.current.pattern})(),Be=te.current;if(Be&&Ae){const e=Be.clientWidth,t=Be.clientHeight,n=Math.max(ke.naturalWidth/(e-20),ke.naturalHeight/(t-20)),a=ke.naturalWidth/n,o=ke.naturalHeight/n;ne.current={iw:a,ih:o,fitScale:n,canvasWidth:e,canvasHeight:t}}Object(a.useEffect)(()=>{Ae&&we(Xe(J?x:null,ne.current))},[Ae]),Object(a.useLayoutEffect)(()=>{if(!ke)return;const e=Be.clientWidth,t=Be.clientHeight;Be.width=e,Be.height=t;const n=Be.getContext("2d");n.save(),n.transform(...xe.clone().inverse().toArray());const a=ne.current,o=a.iw,i=a.ih;if(x){const e=x.x,t=x.y,a=x.w,r=x.h;n.save(),n.globalAlpha=1;const s=[[0,0],[o,0],[o,i],[0,i]],l=[[e*o,t*i],[e*o+a*o,t*i],[e*o+a*o,t*i+r*i],[e*o,t*i+r*i]];n.moveTo(...s[0]),s.forEach(e=>n.lineTo(...e)),n.lineTo(...s[0]),n.closePath(),l.reverse(),n.moveTo(...l[0]),l.forEach(e=>n.lineTo(...e)),n.lineTo(...l[0]),n.fillStyle=Pe||"#f00",n.fill(),n.restore()}n.restore()});const We=ne.current,Ge=We.iw,He=We.ih;let Ve=ue&&ye?Object(C.a)(Object(C.a)({},xe.clone().inverse().applyToPoint(ue.x,ue.y)),{},{w:(ye.x-ue.x)/xe.a,h:(ye.y-ue.y)/xe.d}):null;Ve&&(Ve.w<0&&(Ve.x+=Ve.w,Ve.w*=-1),Ve.h<0&&(Ve.y+=Ve.h,Ve.h*=-1));const Ue={topLeft:xe.clone().inverse().applyToPoint(0,0),bottomRight:xe.clone().inverse().applyToPoint(Ge,He)},Fe=Object(a.useMemo)(()=>{const t=e.filter(e=>e.highlighted);return 1!==t.length?null:t[0]},[e]);return o.a.createElement("div",{style:{width:"100%",height:"100%",maxHeight:"calc(100vh - 68px)",position:"relative",overflow:"hidden",cursor:h?"crosshair":re?"grabbing":g?"grab":m?xe.a<1?"zoom-out":"zoom-in":void 0}},f&&o.a.createElement(k,{key:"crossHairs",mousePosition:Ce}),Ae&&!re&&o.a.createElement(Le,{key:"regionSelectAndTransformBoxes",regions:q&&x?[{type:"box",id:"$$allowed_area",cls:"allowed_area",highlighted:!0,x:x.x,y:x.y,w:x.w,h:x.h,visible:!0,color:"#ff0"}]:e,mouseEvents:Ie,projectRegionBox:Se,dragWithPrimary:g,createWithPrimary:h,zoomWithPrimary:m,onBeginMovePoint:F,onSelectRegion:U,layoutParams:ne,mat:xe,onBeginBoxTransform:A,onBeginMovePolygonPoint:P,onBeginMoveKeypoint:V,onAddPolygonPoint:G,showHighlightBox:E}),Ae&&s&&!re&&o.a.createElement(D,{key:"regionTags"},o.a.createElement(se,{regions:e,projectRegionBox:Se,mouseEvents:Ie,regionClsList:b,regionTagList:y,onBeginRegionEdit:M,onChangeRegion:N,onCloseRegionEdit:_,onDeleteRegion:Y,layoutParams:ne,imageSrc:t,RegionEditLabel:w,onRegionClassAdded:Z,allowComments:Q})),!s&&Fe&&o.a.createElement("div",{key:"topLeftTag",className:ee.fixedRegionLabel},o.a.createElement(oe,{disableClose:!0,allowedClasses:b,allowedTags:y,onChange:N,onDelete:Y,editing:!0,region:Fe,imageSrc:t,allowComments:Q})),m&&null!==Ve&&o.a.createElement("div",{key:"zoomBox",style:{position:"absolute",zIndex:1,border:"1px solid #fff",pointerEvents:"none",left:Ve.x,top:Ve.y,width:Ve.w,height:Ve.h}}),O&&o.a.createElement(H,{key:"pointDistances",regions:e,realSize:r,projectRegionBox:Se,pointDistancePrecision:p}),o.a.createElement(D,Object.assign({style:{width:"100%",height:"100%"}},Ie),o.a.createElement(o.a.Fragment,null,I&&o.a.createElement(Te,{hide:!j,autoSegmentationOptions:T,imagePosition:Ue,regionClsList:b,imageSrc:t,regions:e}),o.a.createElement("canvas",{style:{opacity:.25},className:ee.canvas,ref:te}),o.a.createElement(Ye,{mat:xe,keypointDefinitions:$,imagePosition:Ue,regions:e,fullSegmentationMode:I}),o.a.createElement(ze,{videoPlaying:v,imagePosition:Ue,mouseEvents:Ie,onLoad:Re,videoTime:i,videoSrc:n,imageSrc:t,useCrossOrigin:I,onChangeVideoTime:K,onChangeVideoPlaying:X}))),o.a.createElement("div",{className:ee.zoomIndicator},(1/xe.a*100).toFixed(0),"%"))},Je={container:{display:"flex",flexGrow:1,flexDirection:"column",height:"100%",maxHeight:"100vh",backgroundColor:"#fff",overflow:"hidden","&.fullscreen":{position:"absolute",zIndex:99999,left:0,right:0,top:0,bottom:0}},headerTitle:{fontWeight:"bold",color:U.a[700],paddingLeft:16}},qe=n(405),$e=n.n(qe),Qe=n(406),et=n.n(Qe);var tt=({open:e,onClose:t})=>{const n=De();return o.a.createElement(y.a,{open:e||!1,onClose:t},o.a.createElement(f.a,null,"Settings"),o.a.createElement(E.a,{style:{minWidth:400}},o.a.createElement(et.a,{variant:"flat",noActions:!0,defaultAnswers:n,onQuestionChange:(e,t,a)=>n.changeSetting(e,t),form:{questions:[{type:"boolean",title:"Show Crosshairs",name:"showCrosshairs"},{type:"boolean",title:"Show Highlight Box",name:"showHighlightBox"},{type:"boolean",title:"WASD Mode",name:"wasdMode"},{type:"dropdown",title:"Video Playback Speed",name:"videoPlaybackSpeed",defaultValue:"1x",choices:["0.25x","0.5x","1x","2x"]}]}})),o.a.createElement(O.a,null,o.a.createElement(h.a,{onClick:t},"Close")))},nt=n(256),at=e=>{let t,n,a=null;return"image"===e.annotationType?(a=e.selectedImage,-1===a?(a=null,n=null):(t=["images",a],n=Object(te.getIn)(e,t))):"video"===e.annotationType&&(t=["keyframes",e.currentVideoTime||0],n=Object(te.getIn)(e,t)||null),{currentImageIndex:a,pathToActiveImage:t,activeImage:n}},ot=n(70);const it=[];var rt=(e,t)=>{if(e[t||0])return e[t||0].regions;const n=Object.keys(e).map(e=>parseInt(e)).filter(e=>!isNaN(e));if(0===n.length)return it;n.sort((e,t)=>e-t);let a=n.findIndex(e=>e>=t);if(-1===a)return e[n[n.length-1]].regions||it;if(0===a)return it;const o=n[a-1],i=e[o],r=n[a],s=e[r],l={},c={};var d,g=Object(ot.a)(i.regions);try{for(g.s();!(d=g.n()).done;){const e=d.value;l[e.id]=e}}catch(O){g.e(O)}finally{g.f()}var m,h=Object(ot.a)(s.regions);try{for(h.s();!(m=h.n()).done;){const e=m.value;c[e.id]=e}}catch(O){h.e(O)}finally{h.f()}const p=[],b=(r-t)/(r-o),y=1-b;for(const x in l){const e=[l[x],c[x]],t=e[0],n=e[1];if(n)switch(t.type){case"point":p.push(Object(C.a)(Object(C.a)({},t),{},{highlighted:!1,editingLabels:!1,x:t.x*b+n.x*y,y:t.y*b+n.y*y}));break;case"box":p.push(Object(C.a)(Object(C.a)({},t),{},{highlighted:!1,editingLabels:!1,x:t.x*b+n.x*y,y:t.y*b+n.y*y,w:t.w*b+n.w*y,h:t.h*b+n.h*y}));break;case"polygon":n.points.length===t.points.length?p.push(Object(C.a)(Object(C.a)({},t),{},{highlighted:!1,editingLabels:!1,points:t.points.map((e,t)=>[e[0]*b+n.points[t][0]*y,e[1]*b+n.points[t][1]*y])})):p.push(t);break;case"keypoints":{const e={};for(var f=0,E=Object.entries(t.points);f<E.length;f++){const t=Object(u.a)(E[f],2),a=t[0],o=t[1];e[a]={x:o.x*b+n.points[a].x*y,y:o.y*b+n.points[a].y*y}}p.push(Object(C.a)(Object(C.a)({},t),{},{highlighted:!1,editingLabels:!1,points:e}));break}}else p.push(Object(C.a)(Object(C.a)({},t),{},{highlighted:!1,editingLabels:!1}))}return p};const st=[];var lt=n(109);const ct={};for(var dt=0,gt=[{id:"select_tool",description:"Switch to the Select Tool",binding:"escape"},{id:"zoom_tool",description:"Select the Zoom Tool",binding:"z"},{id:"create_point",description:"Create a point"},{id:"create_bounding_box",description:"Create a bounding box",binding:"b"},{id:"pan_tool",description:"Select the Pan Tool",binding:"m"},{id:"create_polygon",description:"Create a Polygon",binding:"p"},{id:"create_pixel",description:"Create a Pixel Mask"},{id:"save_and_previous_sample",description:"Save and go to previous sample",binding:"ArrowLeft"},{id:"save_and_next_sample",description:"Save and go to next sample",binding:"ArrowRight"},{id:"save_and_exit_sample",description:"Save and exit current sample"},{id:"exit_sample",description:"Exit sample without saving"},{id:"delete_region",description:"Delete selected region",binding:"d"},{id:"undo",description:"Undo latest change",binding:"Ctrl+z"}];dt<gt.length;dt++){const e=gt[dt],t=e.id,n=e.binding;ct[t]=n}const mt=({dispatch:e})=>Object(a.useMemo)(()=>({select_tool:()=>{e({type:"SELECT_TOOL",selectedTool:"select"})},zoom_tool:()=>{e({type:"SELECT_TOOL",selectedTool:"zoom"})},create_point:()=>{e({type:"SELECT_TOOL",selectedTool:"create-point"})},create_bounding_box:()=>{e({type:"SELECT_TOOL",selectedTool:"create-box"})},pan_tool:()=>{e({type:"SELECT_TOOL",selectedTool:"pan"})},create_polygon:()=>{e({type:"SELECT_TOOL",selectedTool:"create-polygon"})},create_pixel:()=>{e({type:"SELECT_TOOL",selectedTool:"create-pixel"})},save_and_previous_sample:()=>{e({type:"HEADER_BUTTON_CLICKED",buttonName:"Prev"})},save_and_next_sample:()=>{e({type:"HEADER_BUTTON_CLICKED",buttonName:"Next"})},save_and_exit_sample:()=>{e({type:"HEADER_BUTTON_CLICKED",buttonName:"Save"})},delete_region:()=>{e({type:"DELETE_SELECTED_REGION"})},undo:()=>{e({type:"RESTORE_HISTORY"})}}),[e]);var ut=n(51),ht=n(52),pt=n(181),bt=n.n(pt),yt=n(411);const ft={marginTop:4,width:16,height:16,marginBottom:4};var Et={select:()=>o.a.createElement(ut.a,{style:ft,size:"xs",fixedWidth:!0,icon:ht.h}),pan:()=>o.a.createElement(ut.a,{style:ft,size:"xs",fixedWidth:!0,icon:ht.f}),zoom:()=>o.a.createElement(ut.a,{style:ft,size:"xs",fixedWidth:!0,icon:ht.i}),"show-tags":()=>o.a.createElement(ut.a,{style:ft,size:"xs",fixedWidth:!0,icon:ht.j}),"create-point":()=>o.a.createElement(ut.a,{style:ft,size:"xs",fixedWidth:!0,icon:ht.b}),"create-box":()=>o.a.createElement(ut.a,{style:ft,size:"xs",fixedWidth:!0,icon:ht.k}),"create-polygon":()=>o.a.createElement(ut.a,{style:ft,size:"xs",fixedWidth:!0,icon:ht.c}),"create-expanding-line":()=>o.a.createElement(ut.a,{style:ft,size:"xs",fixedWidth:!0,icon:ht.e}),"create-line":()=>o.a.createElement(ut.a,{style:ft,size:"xs",fixedWidth:!0,icon:ht.a}),"show-mask":()=>o.a.createElement(ut.a,{style:ft,size:"xs",fixedWidth:!0,icon:ht.g}),"modify-allowed-area":()=>o.a.createElement(ut.a,{style:ft,size:"xs",fixedWidth:!0,icon:ht.d}),"create-keypoints":n.n(yt).a,window:bt.a},Ot=n(249),xt=n.n(Ot),wt=n(412);var vt=(e,t=1)=>{if(e<1e3)return e+"ms";{const n=e/1e3;if(n<60)return Number.isInteger(n)?n+"s":n.toFixed(t)+"s";{const e=n/60;return Number.isInteger(e)?e+"m":e.toFixed(t)+"m"}}};const jt=Object(N.a)("div")({position:"relative",display:"flex",flexGrow:1,minWidth:240,height:64,marginLeft:16,marginRight:16}),It=Object(N.a)("div")({position:"absolute",width:2,marginLeft:-1,height:"100%",backgroundColor:U.a[300],bottom:0}),Tt=Object(N.a)("div")({position:"absolute",userSelect:"none",fontSize:10,color:U.a[600],fontWeight:"bold",bottom:0}),Ct=Object(N.a)("div")({position:"absolute",bottom:"calc(50% + 6px)",fontSize:10,fontWeight:"bold",color:"#fff",display:"grid",placeItems:"center",width:48,marginLeft:-24,borderRadius:2,height:24,backgroundColor:ce.a[500],userSelect:"none",fontVariantNumeric:"tabular-nums","&::before":{position:"absolute",bottom:-6,left:16,content:'""',width:0,height:0,borderTop:"8px solid ".concat(ce.a[500]),borderLeft:"8px solid transparent",borderRight:"8px solid transparent"}}),St=Object(N.a)("div")({position:"absolute",bottom:8,cursor:"pointer",opacity:.75,fontSize:10,fontWeight:"bold",color:"#fff",display:"grid",placeItems:"center",width:16,marginLeft:0,borderTopLeftRadius:2,borderTopRightRadius:2,height:12,marginLeft:-8,backgroundColor:le.a[500],userSelect:"none",fontVariantNumeric:"tabular-nums","&::before":{position:"absolute",bottom:-8,left:0,content:'""',width:0,height:0,borderTop:"8px solid ".concat(le.a[500]),borderLeft:"8px solid transparent",borderRight:"8px solid transparent"}}),Nt=6e4,Mt=[[50,250],[100,500],[250,1e3],[1e3,5e3],[5e3,3e4],[1e4,Nt],[3e4,2*Nt],[Nt,5*Nt],[5*Nt,30*Nt],[10*Nt,60*Nt],[30*Nt,60*Nt*3],[60*Nt,60*Nt*5]];var kt=({currentTime:e=0,duration:t,onChangeCurrentTime:n,keyframes:i})=>{const r=Object(wt.a)(),s=Object(u.a)(r,2),l=s[0],c=s[1],d=Object(a.useState)(e),g=Object(u.a)(d,2),m=g[0],h=g[1],p=Object(R.a)(!1),b=Object(u.a)(p,2),y=b[0],f=b[1],E=Object.keys(i||{}).map(e=>parseInt(e)).filter(e=>!isNaN(e)).sort((e,t)=>e-t);Object(a.useEffect)(()=>{e!==m&&h(e)},[e]);const O=Object(a.useMemo)(()=>(e=>{var t,n=Object(ot.a)(Mt);try{for(n.s();!(t=n.n()).done;){const n=Object(u.a)(t.value,2),a=n[0],o=n[1];if(e/o<6&&e/o>2)return[a,o]}}catch(a){n.e(a)}finally{n.f()}return[e/4,e]})(t),[t]),x=Object(u.a)(O,2),w=x[0],v=x[1],j=Object(L.a)(e=>{if(y){const n=(e.clientX-c.left)/c.width;h(Math.min(t,Math.max(0,Math.floor(n*t))))}}),I=Object(L.a)(e=>{f(!1);const a=(e.clientX-c.left)/c.width,o=Math.min(t,Math.max(0,Math.floor(a*t)));h(o),n(o)});return t?o.a.createElement(jt,{onMouseMove:j,onMouseUp:I,ref:l},xt()(0,t,v).map(e=>o.a.createElement(o.a.Fragment,null,o.a.createElement(It,{key:e,style:{left:e/t*c.width,height:"50%"}}),o.a.createElement(Tt,{style:{left:e/t*c.width+8,bottom:"calc(50% - 12px)"}},vt(e)))),xt()(0,t,w).filter(e=>!Number.isInteger(e/v)).map(e=>o.a.createElement(It,{key:e,style:{left:e/t*c.width,height:"25%"}})),E.map(e=>o.a.createElement(St,{onClick:()=>n(e),key:e,style:{left:e/t*c.width}})),o.a.createElement(Ct,{onMouseDown:e=>f(!0),style:{cursor:y?"grabbing":"grab",left:m/t*c.width}},vt(m))):null},_t=n(437),Lt=n(417);const At=Object(s.a)({container:{margin:8},header:{display:"flex",flexDirection:"row",alignItems:"center",padding:8,paddingLeft:16,paddingRight:16},title:{fontSize:14,fontWeight:"bold",flexGrow:1,paddingLeft:8,color:U.a[800],"& span":{color:U.a[600],fontSize:12}},expandButton:{padding:0,width:30,height:30,"& .icon":{marginTop:-6,width:20,height:20,transition:"500ms transform","&.expanded":{transform:"rotate(180deg)"}}},expandedContent:{maxHeight:300,overflowY:"auto","&.noScroll":{overflowY:"visible",overflow:"visible"}}});var Dt=Object(a.memo)(({icon:e,title:t,subTitle:n,children:i,noScroll:r=!1,expandedByDefault:s=!1})=>{const l=At(),c=(K()(l.expandedContent,r&&"noScroll"),Object(a.useState)(s)),d=Object(u.a)(c,2),g=d[0],m=d[1];Object(L.a)(()=>m(!g));return o.a.createElement(Lt.a,{icon:e,title:t},i)},(e,t)=>e.title===t.title&&e.children===t.children);var Rt=({state:e,lastAction:t})=>{const n=(e.images||[])[e.selectedImage],a=n?(n.regions||[]).filter(e=>e.highlighted):null;return o.a.createElement(Dt,{title:"Debug",icon:o.a.createElement("span",null),expandedByDefault:!0},o.a.createElement("div",{style:{padding:4}},o.a.createElement("div",null,o.a.createElement("b",null,"region"),":"),o.a.createElement("pre",null,JSON.stringify(a,null,"  ")),o.a.createElement("div",null,o.a.createElement("b",null,"lastAction"),":"),o.a.createElement("pre",null,JSON.stringify(t,null,"  ")),o.a.createElement("div",null,o.a.createElement("b",null,"mode"),":"),o.a.createElement("pre",null,JSON.stringify(e.mode,null,"  ")),o.a.createElement("div",null,o.a.createElement("b",null,"frame:")),o.a.createElement("pre",null,JSON.stringify(e.selectedImageFrameTime,null,"  "))))},Pt=n(420),Bt=n.n(Pt);Object(s.a)({});const Wt=[],zt=()=>null;var Gt=Object(a.memo)(({currentImage:e,imageClsList:t=Wt,imageTagList:n=Wt,onChangeImage:i=zt})=>{const r=e||{},s=r.tags,l=void 0===s?[]:s,c=r.cls,d=void 0===c?null:c,g=Object(L.a)(e=>i({cls:e.value})),m=Object(L.a)(e=>i({tags:e.map(e=>e.value)})),u=Object(a.useMemo)(()=>d?{value:d,label:d}:null,[d]),h=Object(a.useMemo)(()=>Object(te.asMutable)(t.map(e=>({value:e,label:e}))),[t]),b=Object(a.useMemo)(()=>Object(te.asMutable)(n.map(e=>({value:e,label:e}))),[n]),y=Object(a.useMemo)(()=>l.map(e=>({value:e,label:e})),[l]);return e?o.a.createElement(Dt,{title:"Image Tags",expandedByDefault:!0,noScroll:!0,icon:o.a.createElement(Bt.a,{style:{color:U.a[700]}})},t.length>0&&o.a.createElement("div",{style:{padding:8}},o.a.createElement(p.default,{placeholder:"Image Classification",onChange:g,value:u,options:h})),n.length>0&&o.a.createElement("div",{style:{padding:8,paddingTop:0}},o.a.createElement(p.default,{isMulti:!0,placeholder:"Image Tags",onChange:m,value:y,options:b}))):null},(e,t)=>e.currentImage.cls===t.currentImage.cls&&e.currentImage.tags===t.currentImage.tags&&e.imageClsList===t.imageClsList&&e.imageTagList===t.imageTagList),Ht=n(421),Vt=n.n(Ht);const Ut=Object(N.a)("div")({cursor:"pointer",display:"flex",alignItems:"center",padding:8,fontSize:14,color:U.a[700],"&.current":{backgroundColor:ce.a[100]},"&:hover":{backgroundColor:U.a[100]},"& .time":{flexGrow:1,fontWeight:"bold","& .regionCount":{marginLeft:8,fontWeight:"normal",color:U.a[500]}},"& .trash":{"& .icon":{fontSize:18,color:U.a[600],transition:"transform 80ms","&:hover":{color:U.a[800],transform:"scale(1.25,1.25)"}}}});var Ft=({currentVideoTime:e,keyframes:t,onChangeVideoTime:n,onDeleteKeyframe:a})=>{const i=Object.keys(t).map(e=>parseInt(e));return o.a.createElement(Dt,{title:"Keyframes",subTitle:"",icon:o.a.createElement(Vt.a,{style:{color:U.a[700]}}),expandedByDefault:!0},i.map(i=>{var r;return o.a.createElement(Ut,{fullWidth:!0,key:i,className:e===i?"current":"",onClick:()=>n(i)},o.a.createElement("div",{className:"time"},vt(i,2),o.a.createElement("span",{className:"regionCount"},"(",((null===(r=t[i])||void 0===r?void 0:r.regions)||[]).length,")")),o.a.createElement("div",{className:"trash"},o.a.createElement(J.a,{onClick:e=>{a(i),e.stopPropagation()},className:"icon"})))}))},Yt=n(422),Kt=n.n(Yt),Xt=n(183),Zt=n.n(Xt);const Jt=Object(N.a)("div")({paddingLeft:16,paddingRight:16,fontSize:12,"& h1":{fontSize:18},"& h2":{fontSize:14},"& h3":{fontSize:12},"& h4":{fontSize:12},"& h5":{fontSize:12},"& h6":{fontSize:12},"& p":{fontSize:12},"& a":{},"& img":{width:"100%"}});var qt=Object(a.memo)(({description:e})=>o.a.createElement(Dt,{title:"Task Description",icon:o.a.createElement(Kt.a,{style:{color:U.a[700]}}),expandedByDefault:!e||""===e},o.a.createElement(Jt,null,o.a.createElement(Zt.a,{source:e})))),$t=n(427),Qt=n.n($t),en=n(879),tn=n(423),nn=n.n(tn),an=n(424),on=n.n(an),rn=n(425),sn=n.n(rn),ln=n(253),cn=n.n(ln),dn=n(426),gn=n.n(dn),mn={container:{fontSize:11,fontWeight:"bold",color:U.a[700],"& .icon":{marginTop:4,width:16,height:16},"& .icon2":{opacity:.5,width:16,height:16,transition:"200ms opacity","&:hover":{cursor:"pointer",opacity:1}}},row:{padding:4,cursor:"pointer","&.header:hover":{backgroundColor:"#fff"},"&.highlighted":{backgroundColor:ce.a[100]},"&:hover":{backgroundColor:ce.a[50],color:U.a[800]}},chip:{display:"flex",flexDirection:"row",padding:2,borderRadius:2,paddingLeft:4,paddingRight:4,alignItems:"center","& .color":{borderRadius:5,width:10,height:10,marginRight:4},"& .text":{}}},un=n(62),hn=n.n(un);const pn=Object(s.a)(mn),bn=Object(N.a)("div")({borderTop:"1px solid ".concat(U.a[200]),marginTop:2,marginBottom:2}),yn=({color:e,text:t})=>{const n=pn();return o.a.createElement("span",{className:n.chip},o.a.createElement("div",{className:"color",style:{backgroundColor:e}}),o.a.createElement("div",{className:"text"},t))},fn=({header:e,highlighted:t,order:n,classification:i,area:r,tags:s,trash:l,lock:c,visible:d,onClick:g})=>{const m=pn(),h=Object(a.useState)(!1),p=Object(u.a)(h,2),b=(p[0],p[1]);return o.a.createElement("div",{onClick:g,onMouseEnter:()=>b(!0),onMouseLeave:()=>b(!1),className:K()(m.row,{header:e,highlighted:t})},o.a.createElement(en.a,{container:!0,alignItems:"center"},o.a.createElement(en.a,{item:!0,xs:2},o.a.createElement("div",{style:{textAlign:"right",paddingRight:10}},n)),o.a.createElement(en.a,{item:!0,xs:5},i),o.a.createElement(en.a,{item:!0,xs:2},o.a.createElement("div",{style:{textAlign:"right",paddingRight:6}},r)),o.a.createElement(en.a,{item:!0,xs:1},l),o.a.createElement(en.a,{item:!0,xs:1},c),o.a.createElement(en.a,{item:!0,xs:1},d)))},En=Object(a.memo)(()=>o.a.createElement(fn,{header:!0,highlighted:!1,order:o.a.createElement(nn.a,{className:"icon"}),classification:o.a.createElement("div",{style:{paddingLeft:10}},"Class"),area:o.a.createElement(on.a,{className:"icon"}),trash:o.a.createElement(J.a,{className:"icon"}),lock:o.a.createElement(re.a,{className:"icon"}),visible:o.a.createElement(cn.a,{className:"icon"})})),On=Object(a.memo)(({region:e,highlighted:t,onSelectRegion:n,onDeleteRegion:a,onChangeRegion:i,visible:r,locked:s,color:l,cls:c,index:d})=>o.a.createElement(fn,{header:!1,highlighted:t,onClick:()=>n(e),order:"#".concat(d+1),classification:o.a.createElement(yn,{text:c||"",color:l||"#ddd"}),area:"",trash:o.a.createElement(J.a,{onClick:()=>a(e),className:"icon2"}),lock:e.locked?o.a.createElement(re.a,{onClick:()=>i(Object(C.a)(Object(C.a)({},e),{},{locked:!1})),className:"icon2"}):o.a.createElement(sn.a,{onClick:()=>i(Object(C.a)(Object(C.a)({},e),{},{locked:!0})),className:"icon2"}),visible:e.visible||void 0===e.visible?o.a.createElement(cn.a,{onClick:()=>i(Object(C.a)(Object(C.a)({},e),{},{visible:!1})),className:"icon2"}):o.a.createElement(gn.a,{onClick:()=>i(Object(C.a)(Object(C.a)({},e),{},{visible:!0})),className:"icon2"})}),(e,t)=>e.highlighted===t.highlighted&&e.visible===t.visible&&e.locked===t.locked&&e.id===t.id&&e.index===t.index&&e.cls===t.cls&&e.color===t.color),xn=[],wn=e=>[e.id,e.color,e.locked,e.visible,e.highlighted];var vn=Object(a.memo)(({regions:e=xn,onDeleteRegion:t,onChangeRegion:n,onSelectRegion:a})=>{const i=pn();return o.a.createElement(Dt,{title:"Regions",subTitle:"",icon:o.a.createElement(Qt.a,{style:{color:U.a[700]}}),expandedByDefault:!0},o.a.createElement("div",{className:i.container},o.a.createElement(En,null),o.a.createElement(bn,null),e.map((e,i)=>o.a.createElement(On,Object.assign({key:e.id},e,{region:e,index:i,onSelectRegion:a,onDeleteRegion:t,onChangeRegion:n})))))},(e,t)=>hn()((e.regions||xn).map(wn),(t.regions||xn).map(wn))),jn=n(428),In=n.n(jn),Tn=n(401),Cn=n(408),Sn=n(217);const Nn=Object(s.a)({img:{width:40,height:40,borderRadius:8}}),Mn=e=>[e.name,(e.regions||[]).length,e.src];Object(a.memo)(({images:e,onSelect:t})=>{const n=Nn();return o.a.createElement(Dt,{title:"Images",subTitle:"(".concat(e.length,")"),icon:o.a.createElement(In.a,{style:{color:U.a[700]}})},o.a.createElement("div",null,o.a.createElement(Tn.a,null,e.map((e,a)=>o.a.createElement(Cn.a,{button:!0,onClick:()=>t(e),dense:!0,key:a},o.a.createElement("img",{className:n.img,src:e.src}),o.a.createElement(Sn.a,{primary:e.name,secondary:"".concat((e.regions||[]).length," Labels")}))))))},(e,t)=>hn()(e.images.map(Mn),t.images.map(Mn)));var kn=n(429),_n=n.n(kn),Ln=n(880),An=n(430),Dn=n.n(An),Rn=n(110),Pn=n.n(Rn);const Bn=Object(s.a)({emptyText:{fontSize:14,fontWeight:"bold",color:U.a[500],textAlign:"center",padding:20}}),Wn={paddingLeft:16};var zn=Object(a.memo)(({history:e,onRestoreHistory:t})=>{const n=Bn();return o.a.createElement(Dt,{title:"History",icon:o.a.createElement(_n.a,{style:{color:U.a[700]}}),expandedByDefault:!0},o.a.createElement(Tn.a,null,0===e.length&&o.a.createElement("div",{className:n.emptyText},"No History Yet"),e.map(({name:e,time:n},a)=>o.a.createElement(Cn.a,{button:!0,dense:!0,key:a},o.a.createElement(Sn.a,{style:Wn,primary:e,secondary:Pn()(n).format("LT")}),0===a&&o.a.createElement(Ln.a,{onClick:()=>t()},o.a.createElement(X.a,null,o.a.createElement(Dn.a,null)))))))},(e,t)=>hn()(e.history.map(e=>[e.name,e.time]),t.history.map(e=>[e.name,e.time])));var Gn=e=>{var t,n,a;const o=null===(t=Object(lt.getApplicationKeyMap)()[e])||void 0===t||null===(n=t.sequences)||void 0===n||null===(a=n[0])||void 0===a?void 0:a.sequence;return o?" (".concat(o,")"):""},Hn=n(1082),Vn=n(432),Un=n.n(Vn),Fn=n(431),Yn=n.n(Fn);const Kn=Object(N.a)("div")({display:"flex",paddingTop:4,paddingBottom:4,paddingLeft:16,paddingRight:16,alignItems:"center",cursor:"pointer",opacity:.7,backgroundColor:"#fff","&:hover":{opacity:1},"&.selected":{opacity:1,fontWeight:"bold"}}),Xn=Object(N.a)("div")({width:12,height:12,borderRadius:12,marginRight:8}),Zn=Object(N.a)("div")({fontSize:11}),Jn=Object(N.a)("div")({flexGrow:1,borderBottom:"2px dotted ".concat(U.a[300]),marginLeft:8,marginRight:8}),qn=Object(N.a)("div")({fontSize:11,textAlign:"center",minWidth:14,paddingTop:2,paddingBottom:2,fontWeight:"bold",color:U.a[700]});var $n=({selectedCls:e,regionClsList:t,onSelectCls:n})=>(Object(a.useEffect)(()=>{const e={};for(let o=0;o<9&&o<t.length;o++)e[o+1]=()=>n(t[o]);const a=t=>{e[t.key]&&(e[t.key](),t.preventDefault(),t.stopPropagation())};return window.addEventListener("keydown",a),()=>window.removeEventListener("keydown",a)},[t,e]),o.a.createElement(Dt,{title:"Classifications",subTitle:"",icon:o.a.createElement(Un.a,{style:{color:U.a[700]}}),expandedByDefault:!0},t.map((t,a)=>o.a.createElement(Kn,{className:K()({selected:t===e}),onClick:()=>n(t)},o.a.createElement(Xn,{style:{backgroundColor:xe[a%xe.length]}}),o.a.createElement(Zn,{className:K()({selected:t===e})},Yn()(t)),o.a.createElement(Jn,null),o.a.createElement(qn,{className:K()({selected:t===e})},a<9?"Key [".concat(a+1,"]"):""))),o.a.createElement(Hn.a,{pb:2})));const Qn=[],ea=Object(s.a)(Je),ta=Object(lt.withHotKeys)(e=>{let t=e.hotKeys,n=e.children,a=e.divRef,i=Object(S.a)(e,["hotKeys","children","divRef"]);return o.a.createElement("div",Object.assign({},Object(C.a)(Object(C.a)({},t),i),{ref:a}),n)}),na=Object(N.a)("div")({width:"100%",height:"100%","& .fullscreen":{width:"100%",height:"100%"}});var aa=({state:e,dispatch:t,alwaysShowNextButton:n=!1,alwaysShowPrevButton:i=!1,RegionEditLabel:r,onRegionClassAdded:s,hideHeader:l,hideHeaderText:c,hideNext:d=!1,hidePrev:g=!1})=>{const m=ea(),u=De(),h=Object(nt.b)(),p=Object(a.useRef)({}),b=(e,...n)=>{const a="".concat(e,"(").concat(n.join(","),")");if(p.current[a])return p.current[a];const o=(...a)=>n.length>0?t(Object(C.a)({type:e},n.reduce((e,t,n)=>(e[t]=a[n],e),{}))):t(Object(C.a)({type:e},a[0]));return p.current[a]=o,o},y=at(e),f=y.currentImageIndex,E=y.activeImage;let O;null!==f&&(O=e.images[f+1]),$e()(()=>t({type:"CANCEL"}),{detectKeys:[27]});E&&E.frameTime;const x=Object(a.useRef)(),w=mt({dispatch:t});let v=(e=>{if("video"!==e.annotationType)return st;const t=e.keyframes,n=e.currentVideoTime,o=void 0===n?0:n;return Object(a.useMemo)(()=>rt(t,o),[t,o])})(e);const j=Object(a.useCallback)(e=>{x.current&&(x.current.contains(document.activeElement)||x.current.contains(e.target)&&(x.current.focus(),e.target.focus()))},[]),I=o.a.createElement(Ze,Object.assign({},u,{showCrosshairs:u.showCrosshairs&&!["select","pan","zoom"].includes(e.selectedTool),key:e.selectedImage,showMask:e.showMask,fullImageSegmentationMode:e.fullImageSegmentationMode,autoSegmentationOptions:e.autoSegmentationOptions,showTags:e.showTags,allowedArea:e.allowedArea,modifyingAllowedArea:"modify-allowed-area"===e.selectedTool,regionClsList:e.regionClsList,regionTagList:e.regionTagList,regions:"image"===e.annotationType?E.regions||[]:v,realSize:E?E.realSize:void 0,videoPlaying:e.videoPlaying,imageSrc:"image"===e.annotationType?E.src:null,videoSrc:"video"===e.annotationType?e.videoSrc:null,pointDistancePrecision:e.pointDistancePrecision,createWithPrimary:e.selectedTool.includes("create"),dragWithPrimary:"pan"===e.selectedTool,zoomWithPrimary:"zoom"===e.selectedTool,showPointDistances:e.showPointDistances,videoTime:"image"===e.annotationType?e.selectedImageFrameTime:e.currentVideoTime,keypointDefinitions:e.keypointDefinitions,onMouseMove:b("MOUSE_MOVE"),onMouseDown:b("MOUSE_DOWN"),onMouseUp:b("MOUSE_UP"),onChangeRegion:b("CHANGE_REGION","region"),onBeginRegionEdit:b("OPEN_REGION_EDITOR","region"),onCloseRegionEdit:b("CLOSE_REGION_EDITOR","region"),onDeleteRegion:b("DELETE_REGION","region"),onBeginBoxTransform:b("BEGIN_BOX_TRANSFORM","box","directions"),onBeginMovePolygonPoint:b("BEGIN_MOVE_POLYGON_POINT","polygon","pointIndex"),onBeginMoveKeypoint:b("BEGIN_MOVE_KEYPOINT","region","keypointId"),onAddPolygonPoint:b("ADD_POLYGON_POINT","polygon","point","pointIndex"),onSelectRegion:b("SELECT_REGION","region"),onBeginMovePoint:b("BEGIN_MOVE_POINT","point"),onImageLoaded:b("IMAGE_LOADED","image"),RegionEditLabel:r,onImageOrVideoLoaded:b("IMAGE_OR_VIDEO_LOADED","metadata"),onChangeVideoTime:b("CHANGE_VIDEO_TIME","newTime"),onChangeVideoPlaying:b("CHANGE_VIDEO_PLAYING","isPlaying"),onRegionClassAdded:s,allowComments:e.allowComments})),T=Object(L.a)(e=>{t({type:"SELECT_TOOL",selectedTool:e.name})}),S=Object(L.a)(e=>{"Fullscreen"===e.name?h.enter():"Window"===e.name&&h.exit(),t({type:"HEADER_BUTTON_CLICKED",buttonName:e.name})}),N=Boolean(window.localStorage.$ANNOTATE_DEBUG_MODE&&e),M=!O||O.regions&&O.regions.length>0;return o.a.createElement(na,null,o.a.createElement(nt.a,{handle:h,onChange:e=>{e||(h.exit(),b("HEADER_BUTTON_CLICKED","buttonName")("Window"))}},o.a.createElement(ta,{tabIndex:-1,divRef:x,onMouseDown:j,onMouseOver:j,allowChanges:!0,handlers:w,className:K()(m.container,e.fullScreen&&"Fullscreen")},o.a.createElement(_t.a,{allowFullscreen:!0,iconDictionary:Et,hideHeader:l,hideHeaderText:c,headerLeftSide:["video"===e.annotationType?o.a.createElement(kt,{currentTime:e.currentVideoTime,duration:e.videoDuration,onChangeCurrentTime:b("CHANGE_VIDEO_TIME","newTime"),keyframes:e.keyframes}):E?o.a.createElement("div",{className:m.headerTitle},E.name):null].filter(Boolean),headerItems:[!g&&{name:"Prev"},!d&&{name:"Next"},"video"!==e.annotationType?null:e.videoPlaying?{name:"Pause"}:{name:"Play"},!M&&E.regions&&{name:"Clone"},{name:"Settings"},e.fullScreen?{name:"Window"}:{name:"Fullscreen"},{name:"Save"}].filter(Boolean),onClickHeaderItem:S,onClickIconSidebarItem:T,selectedTools:[e.selectedTool,e.showTags&&"show-tags",e.showMask&&"show-mask"].filter(Boolean),iconSidebarItems:[{name:"select",helperText:"Select"+Gn("select_tool"),alwaysShowing:!0},{name:"pan",helperText:"Drag/Pan (right or middle click)"+Gn("pan_tool"),alwaysShowing:!0},{name:"zoom",helperText:"Zoom In/Out (scroll)"+Gn("zoom_tool"),alwaysShowing:!0},{name:"show-tags",helperText:"Show / Hide Tags",alwaysShowing:!0},{name:"create-point",helperText:"Add Point"+Gn("create_point")},{name:"create-box",helperText:"Add Bounding Box"+Gn("create_bounding_box")},{name:"create-polygon",helperText:"Add Polygon"+Gn("create_polygon")},{name:"create-line",helperText:"Add Line"},{name:"create-expanding-line",helperText:"Add Expanding Line"},{name:"create-keypoints",helperText:"Add Keypoints (Pose)"},e.fullImageSegmentationMode&&{name:"show-mask",alwaysShowing:!0,helperText:"Show / Hide Mask"},{name:"modify-allowed-area",helperText:"Modify Allowed Area"}].filter(Boolean).filter(t=>t.alwaysShowing||e.enabledTools.includes(t.name)),rightSidebarItems:[N&&o.a.createElement(Rt,{state:N,lastAction:e.lastAction}),e.taskDescription&&o.a.createElement(qt,{description:e.taskDescription}),e.regionClsList&&o.a.createElement($n,{selectedCls:e.selectedCls,regionClsList:e.regionClsList,onSelectCls:b("SELECT_CLASSIFICATION","cls")}),e.labelImages&&o.a.createElement(Gt,{currentImage:E,imageClsList:e.imageClsList,imageTagList:e.imageTagList,onChangeImage:b("CHANGE_IMAGE","delta"),expandedByDefault:!0}),o.a.createElement(vn,{regions:E?E.regions:Qn,onSelectRegion:b("SELECT_REGION","region"),onDeleteRegion:b("DELETE_REGION","region"),onChangeRegion:b("CHANGE_REGION","region")}),e.keyframes&&o.a.createElement(Ft,{onChangeVideoTime:b("CHANGE_VIDEO_TIME","newTime"),onDeleteKeyframe:b("DELETE_KEYFRAME","time"),onChangeCurrentTime:b("CHANGE_VIDEO_TIME","newTime"),currentTime:e.currentVideoTime,duration:e.videoDuration,keyframes:e.keyframes}),o.a.createElement(zn,{history:e.history,onRestoreHistory:b("RESTORE_HISTORY")})].filter(Boolean)},I),o.a.createElement(tt,{open:e.settingsOpen,onClose:()=>t({type:"HEADER_BUTTON_CLICKED",buttonName:"Settings"})}))))};const oa={BEGIN_BOX_TRANSFORM:"Transform/Move Box",BEGIN_MOVE_POINT:"Move Point",DELETE_REGION:"Delete Region"},ia=(e,t)=>Object(te.updateIn)(e,["history"],n=>[{time:Pn()().toDate(),state:Object(te.without)(e,"history"),name:t}].concat((n||[]).slice(0,9)));function ra(e,t,n){return e<=t?t:e>=n?n:e}var sa=e=>{const t=e.expandingWidth||.005,n=e.points.map(({x:n,y:a,angle:o,width:i},r)=>{if(!o){const t=e.points[ra(r+1,0,e.points.length-1)],n=e.points[ra(r-1,0,e.points.length-1)];o=Math.atan2(n.x-t.x,n.y-t.y)+Math.PI/2}const s=Math.sin(o)*(i||t)/2,l=Math.cos(o)*(i||t)/2;return[{x:n+s,y:a+l},{x:n-s,y:a-l}]}),a=n.map(([e,t])=>e),o=n.map(([e,t])=>t).asMutable();o.reverse();const i=a.concat(o).map(({x:e,y:t})=>[e,t]);return Object(C.a)(Object(C.a)({},e),{},{type:"polygon",open:!1,points:i,unfinished:void 0,candidatePoint:void 0})},la=n(254),ca=n.n(la),da=({center:e,scale:t,landmarks:n})=>{const a={};var o,i=Object(ot.a)(Object.entries(n));try{for(i.s();!(o=i.n()).done;){const n=Object(u.a)(o.value,2),i=n[0],r=n[1].defaultPosition;a[i]={x:r[0]*t+e.x,y:r[1]*t+e.y}}}catch(r){i.e(r)}finally{i.f()}return a};const ga=()=>Math.random().toString().split(".")[1];var ma=(e,t)=>{if(e.allowedArea&&"modify-allowed-area"!==e.selectedTool&&["MOUSE_DOWN","MOUSE_UP","MOUSE_MOVE"].includes(t.type)){const n=e.allowedArea;t.x=ca()(t.x,n.x,n.x+n.w),t.y=ca()(t.y,n.y,n.y+n.h)}if("ON_CLS_ADDED"===t.type&&t.cls&&""!==t.cls){const n=e.regionClsList;return Object(C.a)(Object(C.a)({},e),{},{regionClsList:n.concat(t.cls)})}if("MOUSE_MOVE"===t.type){if(Date.now()-(e.lastMouseMoveCall||0)<16)return e;e=Object(te.setIn)(e,["lastMouseMoveCall"],Date.now())}t.type.includes("MOUSE")||(e=Object(te.setIn)(e,["lastAction"],t));const n=at(e),a=n.currentImageIndex,o=n.pathToActiveImage,i=n.activeImage,r=e=>{const t="string"===typeof e||"number"===typeof e?e:e.id;if(!i)return null;const n=(i.regions||[]).findIndex(e=>e.id===t);return-1===n?null:n},s=e=>{if(!i)return null;const t=r(e);if(null===t)return[null,null];return[i.regions[t],t]},l=(t,n)=>{const a=s(t),r=Object(u.a)(a,2),l=r[0],c=r[1];if(!l)return e;if(null!==n)return Object(te.setIn)(e,[...o,"regions",c],Object(C.a)(Object(C.a)({},l),n));{const t=i.regions;return Object(te.setIn)(e,[...o,"regions"],(t||[]).filter(e=>e.id!==l.id))}},c=e=>null===a?e:Object(te.setIn)(e,[...o,"regions"],(i.regions||[]).map(e=>Object(C.a)(Object(C.a)({},e),{},{editingLabels:!1}))),d=(t,n)=>{let a="object"===typeof t?t:{src:t},o=(a.src,a.frameTime);return Object(te.setIn)(Object(te.setIn)(e,["selectedImage"],n),["selectedImageFrameTime"],o)};switch(t.type){case"@@INIT":return e;case"SELECT_IMAGE":return d(t.image,t.imageIndex);case"SELECT_CLASSIFICATION":return Object(te.setIn)(e,["selectedCls"],t.cls);case"CHANGE_REGION":{const n=r(t.region);if(null===n)return e;const a=i.regions[n];if(a.cls!==t.region.cls){const n=(e=ia(e,"Change Region Classification")).regionClsList.indexOf(t.region.cls);-1!==n&&(e=Object(te.setIn)(e,["selectedCls"],t.region.cls),t.region.color=xe[n%xe.length])}return hn()(a.tags,t.region.tags)||(e=ia(e,"Change Region Tags")),hn()(a.comment,t.region.comment)||(e=ia(e,"Change Region Comment")),Object(te.setIn)(e,[...o,"regions",n],t.region)}case"CHANGE_IMAGE":{if(!i)return e;const n=t.delta;for(var g=0,m=Object.keys(n);g<m.length;g++){const t=m[g];"cls"===t&&ia(e,"Change Image Class"),"tags"===t&&ia(e,"Change Image Tags"),e=Object(te.setIn)(e,[...o,t],n[t])}return e}case"SELECT_REGION":{const n=t.region;if(null===r(t.region))return e;const a=[...i.regions||[]].map(e=>Object(C.a)(Object(C.a)({},e),{},{highlighted:e.id===n.id,editingLabels:e.id===n.id}));return Object(te.setIn)(e,[...o,"regions"],a)}case"BEGIN_MOVE_POINT":return e=c(e),Object(te.setIn)(e,["mode"],{mode:"MOVE_REGION",regionId:t.point.id});case"BEGIN_BOX_TRANSFORM":{const n=t.box,a=t.directions;return e=c(e),0===a[0]&&0===a[1]?Object(te.setIn)(e,["mode"],{mode:"MOVE_REGION",regionId:n.id}):Object(te.setIn)(e,["mode"],{mode:"RESIZE_BOX",regionId:n.id,freedom:a,original:{x:n.x,y:n.y,w:n.w,h:n.h}})}case"BEGIN_MOVE_POLYGON_POINT":{const n=t.polygon,a=t.pointIndex;return(e=c(e)).mode&&"DRAW_POLYGON"===e.mode.mode&&0===a?Object(te.setIn)(l(n,{points:n.points.slice(0,-1),open:!1}),["mode"],null):(e=ia(e,"Move Polygon Point"),Object(te.setIn)(e,["mode"],{mode:"MOVE_POLYGON_POINT",regionId:n.id,pointIndex:a}))}case"BEGIN_MOVE_KEYPOINT":{const n=t.region,a=t.keypointId;return e=c(e),e=ia(e,"Move Keypoint"),Object(te.setIn)(e,["mode"],{mode:"MOVE_KEYPOINT",regionId:n.id,keypointId:a})}case"ADD_POLYGON_POINT":{const n=t.polygon,a=t.point,i=t.pointIndex,s=r(n);if(null===s)return e;const l=[...n.points];return l.splice(i,0,a),Object(te.setIn)(e,[...o,"regions",s],Object(C.a)(Object(C.a)({},n),{},{points:l}))}case"MOUSE_MOVE":{const n=t.x,a=t.y;if(!e.mode)return e;if(!i)return e;e.mouseDownAt;switch(e.mode.mode){case"MOVE_POLYGON_POINT":{const t=e.mode,i=t.pointIndex,s=t.regionId,l=r(s);return null===l?e:Object(te.setIn)(e,[...o,"regions",l,"points",i],[n,a])}case"MOVE_KEYPOINT":{const t=e.mode,i=t.keypointId,r=t.regionId,l=s(r),c=Object(u.a)(l,2),d=c[0],g=c[1];return null===g?e:Object(te.setIn)(e,[...o,"regions",g,"points",i],Object(C.a)(Object(C.a)({},d.points[i]),{},{x:n,y:a}))}case"MOVE_REGION":{const t=e.mode.regionId;if("$$allowed_area"===t){const t=e.allowedArea,o=t.w,i=t.h;return Object(te.setIn)(e,["allowedArea"],{x:n-o/2,y:a-i/2,w:o,h:i})}const s=r(t);return null===s?e:Object(te.setIn)(e,[...o,"regions",s],((e,t,n)=>{switch(e.type){case"point":return Object(C.a)(Object(C.a)({},e),{},{x:t,y:n});case"box":return Object(C.a)(Object(C.a)({},e),{},{x:t-e.w/2,y:n-e.h/2})}return e})(i.regions[s],n,a))}case"RESIZE_BOX":{const t=e.mode,s=t.regionId,l=Object(u.a)(t.freedom,2),c=l[0],d=l[1],g=t.original,m=g.x,h=g.y,p=g.w,b=g.h,y=0===c?m:-1===c?Math.min(m+p,n):m,f=0===c?p:-1===c?p+(m-y):Math.max(0,p+(n-m-p)),E=0===d?h:-1===d?Math.min(h+b,a):h,O=0===d?b:-1===d?b+(h-E):Math.max(0,b+(a-h-b));if(f<=.001&&(e=Object(te.setIn)(e,["mode","freedom"],[-1*c,d])),O<=.001&&(e=Object(te.setIn)(e,["mode","freedom"],[c,-1*d])),"$$allowed_area"===s)return Object(te.setIn)(e,["allowedArea"],{x:y,w:f,y:E,h:O});const x=r(s);if(null===x)return e;const w=i.regions[x];return Object(te.setIn)(e,[...o,"regions",x],Object(C.a)(Object(C.a)({},w),{},{x:y,w:f,y:E,h:O}))}case"RESIZE_KEYPOINTS":{const t=e.mode,o=t.regionId,i=t.landmarks,r=t.centerX,s=t.centerY,c=Math.sqrt(Math.pow(r-n,2)+Math.pow(s-a,2));return l(o,{points:da({landmarks:i,center:{x:r,y:s},scale:c/.15})})}case"DRAW_POLYGON":{const t=e.mode.regionId,i=s(t),r=Object(u.a)(i,2),l=r[0],c=r[1];return l?Object(te.setIn)(e,[...o,"regions",c,"points",l.points.length-1],[n,a]):Object(te.setIn)(e,["mode"],null)}case"DRAW_LINE":{const t=e.mode.regionId,i=s(t),r=Object(u.a)(i,2),l=r[0],c=r[1];return l?Object(te.setIn)(e,[...o,"regions",c],Object(C.a)(Object(C.a)({},l),{},{x2:n,y2:a})):Object(te.setIn)(e,["mode"],null)}case"DRAW_EXPANDING_LINE":{const t=e.mode.regionId,i=s(t),r=Object(u.a)(i,2),l=r[0],c=r[1];if(!l)return e;if(Boolean(e.mouseDownAt)){const t=l.points.slice(-1)[0],i=Math.sqrt(Math.pow(t.x-n,2)+Math.pow(t.y-a,2));if(i<.002&&!t.width)return e;return Object(te.setIn)(e,[...o,"regions",c,"points"],l.points.slice(0,-1).concat([Object(C.a)(Object(C.a)({},t),{},{width:2*i,angle:Math.atan2(t.x-n,t.y-a)})]))}return Object(te.setIn)(e,[...o,"regions",c],Object(C.a)(Object(C.a)({},l),{},{candidatePoint:{x:n,y:a}}))}case"SET_EXPANDING_LINE_WIDTH":{const t=e.mode.regionId,i=s(t),r=Object(u.a)(i,2),l=r[0],c=r[1];if(!l)return e;const d=l.points.slice(-1)[0];e.mouseDownAt;return Object(te.setIn)(e,[...o,"regions",c,"expandingWidth"],Math.sqrt(Math.pow(d.x-n,2)+Math.pow(d.y-a,2)))}default:return e}}case"MOUSE_DOWN":{if(!i)return e;const n=t.x,a=t.y;if((e=Object(te.setIn)(e,["mouseDownAt"],{x:n,y:a})).mode)switch(e.mode.mode){case"DRAW_POLYGON":{const t=s(e.mode.regionId),i=Object(u.a)(t,2),r=i[0],l=i[1];if(!r)break;return Object(te.setIn)(e,[...o,"regions",l],Object(C.a)(Object(C.a)({},r),{},{points:r.points.concat([[n,a]])}))}case"DRAW_LINE":{const t=s(e.mode.regionId),i=Object(u.a)(t,2),r=i[0],l=i[1];if(!r)break;return Object(te.setIn)(e,[...o,"regions",l],Object(C.a)(Object(C.a)({},r),{},{x2:n,y2:a})),Object(te.setIn)(e,["mode"],null)}case"DRAW_EXPANDING_LINE":{const t=s(e.mode.regionId),i=Object(u.a)(t,2),r=i[0],l=i[1];if(!r)break;const c=r.points.slice(-1)[0];return r.points.length>1&&Math.sqrt(Math.pow(c.x-n,2)+Math.pow(c.y-a,2))<.002?c.width?e.setIn([...o,"regions",l],sa(r)).setIn(["mode"],null):Object(te.setIn)(e,["mode"],{mode:"SET_EXPANDING_LINE_WIDTH",regionId:e.mode.regionId}):Object(te.setIn)(e,[...o,"regions",l,"points"],r.points.concat([{x:n,y:a,angle:null,width:null}]))}case"SET_EXPANDING_LINE_WIDTH":{const t=s(e.mode.regionId),n=Object(u.a)(t,2),a=n[0],i=n[1];if(!a)break;const r=a.expandingWidth;return e.setIn([...o,"regions",i],sa(Object(C.a)(Object(C.a)({},a),{},{points:a.points.map(e=>e.width?e:Object(C.a)(Object(C.a)({},e),{},{width:r})),expandingWidth:void 0}))).setIn(["mode"],null)}}let r,l=e.selectedCls,c="#ff0000";const d=(e.regionClsList||[]).indexOf(l);switch(-1!==d&&(c=xe[d%xe.length]),e.selectedTool){case"create-point":e=ia(e,"Create Point"),r={type:"point",x:n,y:a,highlighted:!0,editingLabels:!0,color:c,id:ga(),cls:l};break;case"create-box":e=ia(e,"Create Box"),r={type:"box",x:n,y:a,w:0,h:0,highlighted:!0,editingLabels:!1,color:c,cls:l,id:ga()},e=Object(te.setIn)(e,["mode"],{mode:"RESIZE_BOX",editLabelEditorAfter:!0,regionId:r.id,freedom:[1,1],original:{x:n,y:a,w:r.w,h:r.h},isNew:!0});break;case"create-polygon":if(e.mode&&"DRAW_POLYGON"===e.mode.mode)break;e=ia(e,"Create Polygon"),r={type:"polygon",points:[[n,a],[n,a]],open:!0,highlighted:!0,color:c,cls:l,id:ga()},e=Object(te.setIn)(e,["mode"],{mode:"DRAW_POLYGON",regionId:r.id});break;case"create-expanding-line":e=ia(e,"Create Expanding Line"),r={type:"expanding-line",unfinished:!0,points:[{x:n,y:a,angle:null,width:null}],open:!0,highlighted:!0,color:c,cls:l,id:ga()},e=Object(te.setIn)(e,["mode"],{mode:"DRAW_EXPANDING_LINE",regionId:r.id});break;case"create-line":if(e.mode&&"DRAW_LINE"===e.mode.mode)break;e=ia(e,"Create Line"),r={type:"line",x1:n,y1:a,x2:n,y2:a,highlighted:!0,editingLabels:!1,color:c,cls:l,id:ga()},e=Object(te.setIn)(e,["mode"],{mode:"DRAW_LINE",regionId:r.id});break;case"create-keypoints":{e=ia(e,"Create Keypoints");const t=Object.entries(e.keypointDefinitions),o=Object(u.a)(t,1),i=Object(u.a)(o[0],2),s=i[0],l=i[1],c=l.landmarks;l.connections;r={type:"keypoints",keypointsDefinitionId:s,points:da({landmarks:c,center:{x:n,y:a},scale:1}),highlighted:!0,editingLabels:!1,id:ga()},e=Object(te.setIn)(e,["mode"],{mode:"RESIZE_KEYPOINTS",landmarks:c,centerX:n,centerY:a,regionId:r.id,isNew:!0});break}}const g=[...Object(te.getIn)(e,o).regions||[]].map(e=>Object(te.setIn)(e,["editingLabels"],!1).setIn(["highlighted"],!1)).concat(r?[r]:[]);return Object(te.setIn)(e,[...o,"regions"],g)}case"MOUSE_UP":{const n=t.x,a=t.y,i=e.mouseDownAt,r=void 0===i?{x:n,y:a}:i;if(!e.mode)return e;switch((e=Object(te.setIn)(e,["mouseDownAt"],null)).mode.mode){case"RESIZE_BOX":if(e.mode.isNew&&(Math.abs(e.mode.original.x-n)<.002||Math.abs(e.mode.original.y-a)<.002))return Object(te.setIn)(l(e.mode.regionId,null),["mode"],null);if(e.mode.editLabelEditorAfter)return Object(C.a)(Object(C.a)({},l(e.mode.regionId,{editingLabels:!0})),{},{mode:null});case"MOVE_REGION":case"RESIZE_KEYPOINTS":case"MOVE_POLYGON_POINT":case"MOVE_KEYPOINT":return Object(C.a)(Object(C.a)({},e),{},{mode:null});case"CREATE_POINT_LINE":return e;case"DRAW_EXPANDING_LINE":{const t=s(e.mode.regionId),i=Object(u.a)(t,2),l=i[0],c=i[1];if(!l)return e;let d=l;const g=0!==l.points.length?l.points.slice(-1)[0]:r;let m;m=l.points.length>1?l.points.slice(-2)[0]:g;if(!(Math.sqrt(Math.pow(g.x-n,2)+Math.pow(g.y-a,2))>.002))return e;{const e=[...l.points];for(let t=0;t<e.length-1;t++)e[t].width||(e[t]=Object(C.a)(Object(C.a)({},e[t]),{},{width:g.width}));d=Object(te.setIn)(l,["points"],e)}return Object(te.setIn)(e,[...o,"regions",c],d)}default:return e}}case"OPEN_REGION_EDITOR":{t.region;const n=r(t.region);if(null===n)return e;const a=Object(te.setIn)(i.regions.map(e=>Object(C.a)(Object(C.a)({},e),{},{highlighted:!1,editingLabels:!1})),[n],Object(C.a)(Object(C.a)({},(i.regions||[])[n]),{},{highlighted:!0,editingLabels:!0}));return Object(te.setIn)(e,[...o,"regions"],a)}case"CLOSE_REGION_EDITOR":{t.region;const n=r(t.region);return null===n?e:Object(te.setIn)(e,[...o,"regions",n],Object(C.a)(Object(C.a)({},(i.regions||[])[n]),{},{editingLabels:!1}))}case"DELETE_REGION":return null===r(t.region)?e:Object(te.setIn)(e,[...o,"regions"],(i.regions||[]).filter(e=>e.id!==t.region.id));case"DELETE_SELECTED_REGION":return Object(te.setIn)(e,[...o,"regions"],(i.regions||[]).filter(e=>!e.highlighted));case"HEADER_BUTTON_CLICKED":switch(t.buttonName.toLowerCase()){case"prev":return null===a||0===a?e:d(e.images[a-1],a-1);case"next":return null===a||a===e.images.length-1?e:d(e.images[a+1],a+1);case"clone":return null===a||a===e.images.length-1?e:Object(te.setIn)(d(e.images[a+1],a+1),["images",a+1,"regions"],i.regions);case"settings":return Object(te.setIn)(e,["settingsOpen"],!e.settingsOpen);case"help":return e;case"fullscreen":return Object(te.setIn)(e,["fullScreen"],!0);case"exit fullscreen":case"window":return Object(te.setIn)(e,["fullScreen"],!1);case"hotkeys":return e;case"exit":case"done":default:return e}case"SELECT_TOOL":return"show-tags"===t.selectedTool?(h="showTags",p=!e.showTags,window.localStorage.setItem("__REACT_IMAGE_ANNOTATE_".concat(h),JSON.stringify(p)),Object(te.setIn)(e,["showTags"],!e.showTags)):"show-mask"===t.selectedTool?Object(te.setIn)(e,["showMask"],!e.showMask):("modify-allowed-area"!==t.selectedTool||e.allowedArea||(e=Object(te.setIn)(e,["allowedArea"],{x:0,y:0,w:1,h:1})),e=Object(te.setIn)(e,["mode"],null),Object(te.setIn)(e,["selectedTool"],t.selectedTool));case"CANCEL":{const t=e.mode;if(t)switch(t.mode){case"DRAW_EXPANDING_LINE":case"SET_EXPANDING_LINE_WIDTH":case"DRAW_POLYGON":return l(t.regionId,null);case"MOVE_POLYGON_POINT":case"RESIZE_BOX":case"MOVE_REGION":return Object(te.setIn)(e,["mode"],null);default:return e}const n=i.regions;if(n&&n.some(e=>e.editingLabels))return Object(te.setIn)(e,[...o,"regions"],n.map(e=>Object(C.a)(Object(C.a)({},e),{},{editingLabels:!1})));if(n)return Object(te.setIn)(e,[...o,"regions"],n.map(e=>Object(C.a)(Object(C.a)({},e),{},{highlighted:!1})));break}}var h,p;return e},ua=(e,t)=>{const n=at(e),a=n.currentImageIndex;n.pathToActiveImage,n.activeImage;switch(t.type){case"IMAGE_OR_VIDEO_LOADED":return Object(te.setIn)(e,["images",a,"pixelSize"],{w:t.metadata.naturalWidth,h:t.metadata.naturalHeight})}return e},ha=(e,t)=>{const n=()=>Object(te.setIn)(ia(e,"Add Keyframe"),["keyframes",e.currentVideoTime||0],{regions:rt(e.keyframes,e.currentVideoTime)});switch(t.type){case"IMAGE_OR_VIDEO_LOADED":{const n=t.metadata.duration;if("number"===typeof n)return Object(te.setIn)(e,["videoDuration"],1e3*n)}case"HEADER_BUTTON_CLICKED":switch(t.buttonName.toLowerCase()){case"play":return Object(te.setIn)(e,["videoPlaying"],!0);case"pause":return Object(te.setIn)(e,["videoPlaying"],!1)}case"CHANGE_VIDEO_TIME":return Object(te.setIn)(e,["currentVideoTime"],t.newTime);case"CHANGE_VIDEO_PLAYING":return Object(te.setIn)(e,["videoPlaying"],t.isPlaying);case"DELETE_KEYFRAME":return Object(te.setIn)(e,["keyframes"],Object(te.without)(e.keyframes,t.time))}if(!e.keyframes[e.currentVideoTime])switch(t.type){case"BEGIN_BOX_TRANSFORM":case"BEGIN_MOVE_POINT":case"BEGIN_MOVE_KEYPOINT":case"BEGIN_MOVE_POLYGON_POINT":case"ADD_POLYGON_POINT":case"SELECT_REGION":case"CHANGE_REGION":case"DELETE_REGION":case"OPEN_REGION_EDITOR":return n();case"MOUSE_DOWN":switch(e.selectedTool){case"create-point":case"create-polygon":case"create-box":case"create-keypoints":return n()}}return e},pa=(e,t)=>{try{return JSON.parse(window.localStorage["__REACT_IMAGE_ANNOTATE_".concat(e)])}catch(n){return t}};var ba=({images:e,allowedArea:t,selectedImage:n=(e&&e.length>0?0:void 0),showPointDistances:i,pointDistancePrecision:r,showTags:s=pa("showTags",!0),enabledTools:l=["select","create-point","create-box","create-polygon","create-line","create-expanding-line","show-mask"],selectedTool:c="select",regionTagList:d=[],regionClsList:g=[],imageTagList:m=[],imageClsList:h=[],keyframes:p={},taskDescription:b="",fullImageSegmentationMode:y=!1,RegionEditLabel:f,videoSrc:E,videoTime:O=0,videoName:x,onExit:w,onNextImage:v,onPrevImage:j,keypointDefinitions:I,autoSegmentationOptions:T={type:"autoseg"},hideHeader:S,hideHeaderText:N,hideNext:M,hidePrev:k,allowComments:_})=>{"string"===typeof n&&-1===(n=(e||[]).findIndex(e=>e.src===n))&&(n=void 0);const A=e?"image":"video",D=Object(a.useReducer)((W=((...e)=>(t,n)=>{var a,o=Object(ot.a)(e);try{for(o.s();!(a=o.n()).done;)t=(0,a.value)(t,n)}catch(i){o.e(i)}finally{o.f()}return t})("image"===A?ua:ha,ma),(e,t)=>{const n=e,a=W(e,t);if("RESTORE_HISTORY"===t.type){if(e.history.length>0)return Object(te.setIn)(a.history[0].state,["history"],a.history.slice(1))}else if(n!==a&&Object.keys(oa).includes(t.type))return Object(te.setIn)(a,["history"],[{time:Pn()().toDate(),state:Object(te.without)(n,"history"),name:oa[t.type]||t.type}].concat(a.history||[]).slice(0,9));return a}),ne()(Object(C.a)({annotationType:A,showTags:s,allowedArea:t,showPointDistances:i,pointDistancePrecision:r,selectedTool:c,fullImageSegmentationMode:y,autoSegmentationOptions:T,mode:null,taskDescription:b,showMask:!0,labelImages:h.length>0||m.length>0,regionClsList:g,regionTagList:d,imageClsList:h,imageTagList:m,currentVideoTime:O,enabledTools:l,history:[],videoName:x,keypointDefinitions:I,allowComments:_},"image"===A?{selectedImage:n,images:e,selectedImageFrameTime:e&&e.length>0?e[0].frameTime:void 0}:{videoSrc:E,keyframes:p}))),R=Object(u.a)(D,2),P=R[0],B=R[1];var W;const z=Object(L.a)(e=>{if("HEADER_BUTTON_CLICKED"===e.type){if(["Exit","Done","Save","Complete"].includes(e.buttonName))return w(Object(te.without)(P,"history"));if("Next"===e.buttonName&&v)return v(Object(te.without)(P,"history"));if("Prev"===e.buttonName&&j)return j(Object(te.without)(P,"history"))}B(e)}),G=Object(L.a)(e=>{B({type:"ON_CLS_ADDED",cls:e})});return Object(a.useEffect)(()=>{void 0!==n&&B({type:"SELECT_IMAGE",imageIndex:n,image:P.images[n]})},[n,P.images]),e||E?o.a.createElement(Re,null,o.a.createElement(aa,{RegionEditLabel:f,alwaysShowNextButton:Boolean(v),alwaysShowPrevButton:Boolean(j),state:P,dispatch:z,onRegionClassAdded:G,hideHeader:S,hideHeaderText:N,hideNext:M,hidePrev:k})):'Missing required prop "images" or "videoSrc"'};class ya extends a.Component{constructor(...e){super(...e),this.state={hasError:!1,err:""}}componentDidCatch(e,t){this.setState({hasError:!0,err:e.toString()+"\n\n"+t.componentStack})}render(){return this.state.hasError?o.a.createElement(y.a,{open:this.state.hasError,onClose:this.props.onClose},o.a.createElement(f.a,null,"Error Loading Annotator"),o.a.createElement(E.a,null,o.a.createElement("pre",null,this.state.err)),o.a.createElement(O.a,null,o.a.createElement(h.a,{onClick:this.props.onClose},"Close"))):this.props.children}}var fa=()=>{const e=Object(a.useState)(!1),t=Object(u.a)(e,2),n=t[0],i=t[1],r=Object(a.useState)(I.Custom()),s=Object(u.a)(r,2),l=s[0],c=s[1],d=Object(a.useState)(),g=Object(u.a)(d,2),m=g[0],h=g[1];return o.a.createElement("div",null,n?o.a.createElement(ya,{onClose:()=>{i(!1)}},o.a.createElement(ba,Object.assign({},l,{onExit:e=>{delete e.lastAction,h(e),i(!1)}}))):o.a.createElement(T,{lastOutput:m,onOpenAnnotator:e=>{c(e),i(!0)}}))},Ea=n(433),Oa=(n(891),n(1173)),xa=n(435);const wa=Object(N.a)("div")({display:"flex",flexDirection:"column",alignItems:"center"}),va=Object(N.a)("div")({width:"100%",boxSizing:"border-box",display:"flex",flexDirection:"column",maxWidth:1200}),ja=Object(N.a)("div")({width:"100%",display:"flex",justifyContent:"center",backgroundColor:ce.a[600],padding:8,boxSizing:"border-box"}),Ia=Object(N.a)(h.a)({color:"white",margin:8,padding:16,paddingLeft:24,paddingRight:24}),Ta=Object(N.a)("div")({display:"flex",justifyContent:"center",width:"100%",backgroundColor:ce.a[500],padding:16,color:"white",boxSizing:"border-box"}),Ca=Object(N.a)("div")({fontSize:48,fontWeight:"bold",paddingTop:64,textShadow:"0px 1px 5px rgba(0,0,0,0.3)"}),Sa=Object(N.a)("div")({paddingTop:32,lineHeight:1.5,fontSize:24,textShadow:"0px 1px 3px rgba(0,0,0,0.2)"}),Na=Object(N.a)("div")({paddingTop:32,paddingBottom:48}),Ma=Object(N.a)("div")({display:"flex",padding:16,paddingTop:32,flexDirection:"column"}),ka=({language:e,value:t})=>o.a.createElement(Oa.a,{language:e,style:xa.docco},t);function _a(e,t){return"string"===typeof t?e+t:o.a.Children.toArray(t.props.children).reduce(_a,e)}function La(e){var t=o.a.Children.toArray(e.children).reduce(_a,"").toLowerCase().replace(/\W/g,"-");return o.a.createElement("h"+e.level,{id:t},e.children)}var Aa=()=>o.a.createElement(wa,null,o.a.createElement(ja,{id:"about"},o.a.createElement(va,{style:{flexDirection:"row",flexGrow:1}},o.a.createElement(Ia,{href:"#features"},"Features"),o.a.createElement(Ia,{href:"#usage"},"Usage"),o.a.createElement(Ia,{href:"#props"},"Props"),o.a.createElement(Ia,{href:"./demo"},"Demo Playground"))),o.a.createElement(Ta,null,o.a.createElement(va,null,o.a.createElement(Ca,null,"React Image Annotate"),o.a.createElement(Sa,null,"Powerful React component for image annotations with bounding boxes, tagging, classification, multiple images and polygon segmentation."),o.a.createElement(Na,null,o.a.createElement(Ea.a,{href:"https://github.com/waoai/react-image-annotate","data-size":"large","data-show-count":"true","aria-label":"Star waoai/react-image-annotate on GitHub"},"Star")))),o.a.createElement(va,{className:"markdown-body"},o.a.createElement(Ma,{className:"markdown-body"},o.a.createElement(Zt.a,{escapeHtml:!1,source:'# Features\n\n- Simple input/output format\n- Bounding Box, Point and Polygon Annotation\n- Zooming, Scaling, Panning\n- Multiple Images\n- Cursor Crosshair\n\n![Screenshot of Annotator](https://user-images.githubusercontent.com/1910070/51199716-83c72080-18c5-11e9-837c-c3a89c8caef4.png)\n\n# Usage\n\n## Installation\n\n```bash\nnpm install react-image-annotate\n```\n\n## Basic Example\n\n```javascript\nimport ReactImageAnnotate from "react-image-annotate"\n\nconst App = () => (\n  <ReactImageAnnotate\n    selectedImage="https://example.com/image1.png"\n    taskDescription="# Draw region around each animal."\n    images={[{ src: "https://example.com/image1.png", name: "Image 1" }]}\n    regionClsList={["Dog", "Cat"]}\n    enabledTools={["create-box"]}\n  />\n)\n```\n\n# Props\n\nAll of the following properties can be defined on the `ReactImageAnnotate` component...\n\n| Prop                     | Type (\\* = required)                             | Description                                                                             | Default       |\n| ------------------------ | ------------------------------------------------ | --------------------------------------------------------------------------------------- | ------------- |\n| `taskDescription`        | \\*`string`                                       | Markdown description for what to do in the image.                                       |               |\n| `allowedArea`            | `{ x: number, y: number, w: number, h: number }` | Area that is available for annotation.                                                  | Entire image. |\n| `regionTagList`          | `Array<string>`                                  | Allowed "tags" (mutually inclusive classifications) for regions.                        |               |\n| `regionClsList`          | `Array<string>`                                  | Allowed "classes" (mutually exclusive classifications) for regions.                     |               |\n| `imageTagList`           | `Array<string>`                                  | Allowed tags for entire image.                                                          |               |\n| `imageClsList`           | `Array<string>`                                  | Allowed classes for entire image.                                                       |               |\n| `enabledTools`           | `Array<string>`                                  | Tools allowed to be used. e.g. "select", "create-point", "create-box", "create-polygon" | Everything.   |\n| `showTags`               | `boolean`                                        | Show tags and allow tags on regions.                                                    | `true`        |\n| `selectedImage`          | `string`                                         | URL of initially selected image.                                                        |               |\n| `images`                 | `Array<Image>`                                   | Array of images to load into annotator                                                  |               |\n| `showPointDistances`     | `boolean`                                        | Show distances between points.                                                          | `false`       |\n| `pointDistancePrecision` | `number`                                         | Precision on displayed points (e.g. 3 => 0.123)                                         |               |\n| `onExit`                 | `MainLayoutState => any`                         | Called when "Save" is called.                                                           |               |\n\n# Sponsors\n\n[![wao.ai sponsorship image](https://s3.amazonaws.com/asset.workaround.online/sponsorship-banner-1.png)](https://wao.ai)\n',renderers:{code:ka,heading:La}}))));n(1080);const Da=()=>{const e=window.location.pathname.replace(/\/$/,"").split("/").slice(-1)[0];return o.a.createElement(m,null,"demo"===e?o.a.createElement(fa,null):o.a.createElement(Aa,null))};r.a.render(o.a.createElement(Da,null),document.getElementById("root"))},446:function(e,t,n){e.exports=n(1081)},891:function(e,t,n){}},[[446,1,2]]]);
//# sourceMappingURL=main.726a9a97.chunk.js.map